"undefined"!=typeof window&&function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.Hls=b():a.Hls=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})},b.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},b.t=function(a,c){if(1&c&&(a=b(a)),8&c)return a;if(4&c&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&c&&"string"!=typeof a)for(var e in a)b.d(d,e,function(b){return a[b]}.bind(null,e));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s=31)}([function(a,b,c){"use strict";function d(){}function e(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];b.forEach(function(b){h[b]=a[b]?a[b].bind(a):function(a){var b=i.console[a];return b?function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c[0]&&(c[0]=function(a,b){return b="["+a+"] > "+b}(a,c[0])),b.apply(i.console,c)}:d}(b)})}Object.defineProperty(b,"__esModule",{value:!0});var f=c(6),g={trace:d,debug:d,log:d,warn:d,info:d,error:d},h=g,i=f.getSelfScope();b.enableLogs=function(a){if(!0===a||"object"==typeof a){e(a,"debug","log","info","warn","error");try{h.log()}catch(a){h=g}}else h=g},b.logger=h},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(6).getSelfScope().Number;b.Number=d,d.isFinite=d.isFinite||function(a){return"number"==typeof a&&isFinite(a)}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},b.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(0),e=c(3),f=c(1),g={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function a(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.hls=a,this.onEvent=this.onEvent.bind(this),this.handledEvents=b,this.useGenericHandler=!0,this.registerListeners()}return a.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},a.prototype.onHandlerDestroying=function(){},a.prototype.onHandlerDestroyed=function(){},a.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},a.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if(g[a])throw new Error("Forbidden event-name: "+a);this.hls.on(a,this.onEvent)},this)},a.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)},a.prototype.onEvent=function(a,b){this.onEventGeneric(a,b)},a.prototype.onEventGeneric=function(a,b){try{(function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)}).call(this,a,b).call()}catch(b){d.logger.error("An internal error happened while handling event "+a+'. Error message: "'+b.message+'". Here is a stacktrace:',b),this.hls.trigger(f["default"].ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:b})}},a}();b["default"]=h},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.isBuffered=function(a,b){try{if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0}catch(a){}return!1},a.bufferInfo=function(a,b,c){try{if(a){var d=a.buffered,e=[],f=void 0;for(f=0;f<d.length;f++)e.push({start:d.start(f),end:d.end(f)});return this.bufferedInfo(e,b,c)}}catch(a){}return{len:0,start:b,end:b,nextStart:void 0}},a.bufferedInfo=function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c||b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&m>b)e=l,d=(f=m)-b;else if(l>b+c){g=l;break}}return{len:d,start:e,end:f,nextStart:g}},a}();b.BufferHelper=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(1);b.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var g=function(c){function g(a){var b=c.call(this,a,f["default"].BUFFER_APPENDED,f["default"].FRAG_BUFFERED,f["default"].FRAG_LOADED)||this;return b.bufferPadding=.2,b.fragments=Object.create(null),b.timeRanges=Object.create(null),b.config=a.config,b}return d(g,c),g.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,e["default"].prototype.destroy.call(this),c.prototype.destroy.call(this)},g.prototype.getBufferedFrag=function(a,b){var c=this.fragments,d=Object.keys(c).filter(function(d){var e=c[d];if(e.body.type!==b)return!1;if(!e.buffered)return!1;var f=e.body;return f.startPTS<=a&&a<=f.endPTS});if(0===d.length)return null;var e=d.pop();return c[e].body},g.prototype.detectEvictedFragments=function(a,b){var c,d,e=this;Object.keys(this.fragments).forEach(function(f){var g=e.fragments[f];if(!0===g.buffered){var h=g.range[a];if(h){c=h.time;for(var i=0;i<c.length;i++)if(d=c[i],!1===e.isTimeBuffered(d.startPTS,d.endPTS,b)){e.removeFragment(g.body);break}}}})},g.prototype.detectPartialFragments=function(a){var b=this,c=this.getFragmentKey(a),d=this.fragments[c];d&&(d.buffered=!0,Object.keys(this.timeRanges).forEach(function(c){if(a.hasElementaryStream(c)){var e=b.timeRanges[c];d.range[c]=b.getBufferedTimes(a.startPTS,a.endPTS,e)}}))},g.prototype.getBufferedTimes=function(a,b,c){for(var d,e,f=[],g=!1,h=0;h<c.length;h++){if(d=c.start(h)-this.bufferPadding,e=c.end(h)+this.bufferPadding,a>=d&&e>=b){f.push({startPTS:Math.max(a,c.start(h)),endPTS:Math.min(b,c.end(h))});break}if(e>a&&b>d)f.push({startPTS:Math.max(a,c.start(h)),endPTS:Math.min(b,c.end(h))}),g=!0;else if(d>=b)break}return{time:f,partial:g}},g.prototype.getFragmentKey=function(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn},g.prototype.getPartialFragment=function(a){var b,c,d,e=this,f=null,g=0;return Object.keys(this.fragments).forEach(function(h){var i=e.fragments[h];e.isPartial(i)&&(c=i.body.startPTS-e.bufferPadding,d=i.body.endPTS+e.bufferPadding,a>=c&&d>=a&&(b=Math.min(a-c,d-a),b>=g&&(f=i.body,g=b)))}),f},g.prototype.getState=function(a){var c=this.getFragmentKey(a),d=this.fragments[c],e=b.FragmentState.NOT_LOADED;return void 0!==d&&(e=d.buffered?!0===this.isPartial(d)?b.FragmentState.PARTIAL:b.FragmentState.OK:b.FragmentState.APPENDING),e},g.prototype.isPartial=function(a){return!0===a.buffered&&(void 0!==a.range.video&&!0===a.range.video.partial||void 0!==a.range.audio&&!0===a.range.audio.partial)},g.prototype.isTimeBuffered=function(a,b,c){for(var d,e,f=0;f<c.length;f++){if(d=c.start(f)-this.bufferPadding,e=c.end(f)+this.bufferPadding,a>=d&&e>=b)return!0;if(d>=b)return!1}return!1},g.prototype.onFragLoaded=function(b){var c=b.frag;a.isFinite(c.sn)&&!c.bitrateTest&&(this.fragments[this.getFragmentKey(c)]={body:c,range:Object.create(null),buffered:!1})},g.prototype.onBufferAppended=function(a){var b=this;this.timeRanges=a.timeRanges,Object.keys(this.timeRanges).forEach(function(a){var c=b.timeRanges[a];b.detectEvictedFragments(a,c)})},g.prototype.onFragBuffered=function(a){this.detectPartialFragments(a.frag)},g.prototype.hasFragment=function(a){var b=this.getFragmentKey(a);return void 0!==this.fragments[b]},g.prototype.removeFragment=function(a){var b=this.getFragmentKey(a);delete this.fragments[b]},g.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},g}(e["default"]);b.FragmentTracker=g}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){function d(b,c,d){var e=b[c],f=b[d],g=f.startPTS;a.isFinite(g)?d>c?(e.duration=g-e.start,e.duration<0&&h.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!")):(f.duration=e.start-g,f.duration<0&&h.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!")):f.start=d>c?e.start+e.duration:Math.max(e.start-f.duration,0)}function e(b,c,e,f,g,h){var i=e;if(a.isFinite(c.startPTS)){var j=Math.abs(c.startPTS-e);a.isFinite(c.deltaPTS)?c.deltaPTS=Math.max(j,c.deltaPTS):c.deltaPTS=j,i=Math.max(e,c.startPTS),e=Math.min(e,c.startPTS),f=Math.max(f,c.endPTS),g=Math.min(g,c.startDTS),h=Math.max(h,c.endDTS)}var k=e-c.start;c.start=c.startPTS=e,c.maxStartPTS=i,c.endPTS=f,c.startDTS=g,c.endDTS=h,c.duration=f-e;var l,m,n,o=c.sn;if(!b||o<b.startSN||o>b.endSN)return 0;for(l=o-b.startSN,(m=b.fragments)[l]=c,n=l;n>0;n--)d(m,n,n-1);for(n=l;n<m.length-1;n++)d(m,n,n+1);return b.PTSKnown=!0,k}function f(a,b,c){if(a&&b)for(var d=Math.max(a.startSN,b.startSN)-b.startSN,e=Math.min(a.endSN,b.endSN)-b.startSN,f=b.startSN-a.startSN,g=d;e>=g;g++){var h=a.fragments[f+g],i=b.fragments[g];if(!h||!i)break;c(h,i,g)}}function g(a,b){var c=b.startSN-a.startSN,d=a.fragments,e=b.fragments;if(!(0>c||c>d.length))for(var f=0;f<e.length;f++)e[f].start+=d[c].start}Object.defineProperty(b,"__esModule",{value:!0});var h=c(0);b.addGroupId=function(a,b,c){switch(b){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(c);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(c)}},b.updatePTS=d,b.updateFragPTSDTS=e,b.mergeDetails=function(b,c){c.initSegment&&b.initSegment&&(c.initSegment=b.initSegment);var d,i=0;if(f(b,c,function(b,e){i=b.cc-e.cc,a.isFinite(b.startPTS)&&(e.start=e.startPTS=b.startPTS,e.endPTS=b.endPTS,e.duration=b.duration,e.backtracked=b.backtracked,e.dropped=b.dropped,d=e),c.PTSKnown=!0}),c.PTSKnown){if(i){h.logger.log("discontinuity sliding from playlist, take drift into account");for(var j=c.fragments,k=0;k<j.length;k++)j[k].cc+=i}d?e(c,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS):g(b,c),c.PTSKnown=b.PTSKnown}},b.mergeSubtitlePlaylists=function(a,b,c){void 0===c&&(c=0);var d=-1;f(a,b,function(a,b,c){b.start=a.start,d=c});var e=b.fragments;if(0>d)e.forEach(function(a){a.start+=c});else for(var g=d+1;g<e.length;g++)e[g].start=e[g-1].start+e[g-1].duration},b.mapFragmentIntersection=f,b.adjustSliding=g,b.computeReloadInterval=function(a,b,c){var d=1e3*(b.averagetargetduration?b.averagetargetduration:b.targetduration),e=d/2;return a&&b.endSN===a.endSN&&(d=e),c&&(d=Math.max(e,d-(window.performance.now()-c))),Math.round(d)}}).call(this,c(2).Number)},function(a,b,c){!function(b){var c=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,d=/^([^\/?#]*)(.*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,g={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),!(b=b.trim())){if(!c.alwaysNormalize)return a;var e=g.parseURL(a);if(!e)throw new Error("Error trying to parse base URL.");return e.path=g.normalizePath(e.path),g.buildURLFromParts(e)}var f=g.parseURL(b);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=g.normalizePath(f.path),g.buildURLFromParts(f)):b;var h=g.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var i=d.exec(h.path);h.netLoc=i[1],h.path=i[2]}h.netLoc&&!h.path&&(h.path="/");var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(j.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var k=h.path,l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}else j.path=h.path,f.params||(j.params=h.params,f.query||(j.query=h.query));return null===j.path&&(j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path),g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=g}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;d>=c;){var g=b(f=a[e=(c+d)/2|0]);if(g>0)c=e+1;else{if(!(0>g))return f;d=e-1}}return null}}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.isHeader=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},a.isFooter=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},a.getID3Data=function(b,c){for(var d=c,e=0;a.isHeader(b,c);)e+=10,e+=a._readSize(b,c+6),a.isFooter(b,c+10)&&(e+=10),c+=e;return e>0?b.subarray(d,d+e):void 0},a._readSize=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},a.getTimeStamp=function(b){for(var c=a.getID3Frames(b),d=0;d<c.length;d++){var e=c[d];if(a.isTimeStampFrame(e))return a._readTimeStamp(e)}},a.isTimeStampFrame=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},a._getFrameData=function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,4);return{type:c,size:d,data:b.subarray(10,10+d)}},a.getID3Frames=function(b){for(var c=0,d=[];a.isHeader(b,c);){for(var e=a._readSize(b,c+6),f=(c+=10)+e;f>c+8;){var g=a._getFrameData(b.subarray(c)),h=a._decodeFrame(g);h&&d.push(h),c+=g.size+10}a.isFooter(b,c)&&(c+=10)}return d},a._decodeFrame=function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"T"===b.type[0]?a._decodeTextFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):void 0},a._readTimeStamp=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}},a._decodePrivFrame=function(b){if(!(b.size<2)){var c=a._utf8ArrayToStr(b.data,!0),d=new Uint8Array(b.data.subarray(c.length+1));return{key:b.type,info:c,data:d.buffer}}},a._decodeTextFrame=function(b){if(!(b.size<2)){if("TXXX"===b.type){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data.subarray(1));return{key:b.type,data:f}}},a._decodeURLFrame=function(b){if("WXXX"===b.type){if(b.size<2)return;var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data);return{key:b.type,data:f}},a._utf8ArrayToStr=function(a,b){void 0===b&&(b=!1);for(var c,d,e,f=a.length,g="",h=0;f>h;){if(0===(c=a[h++])&&b)return g;if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(c);break;case 12:case 13:d=a[h++],g+=String.fromCharCode((31&c)<<6|63&d);break;case 14:d=a[h++],e=a[h++],g+=String.fromCharCode((15&c)<<12|(63&d)<<6|(63&e)<<0)}}return g},a}(),e=d._utf8ArrayToStr;b.utf8ArrayToStr=e,b["default"]=d},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c(9),e=c(18),f=function(){function b(){var a;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((a={})[b.ElementaryStreamTypes.AUDIO]=!1,a[b.ElementaryStreamTypes.VIDEO]=!1,a)}return Object.defineProperty(b,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=d.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var a=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c||0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0],this._byteRange=a}return a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"endProgramDateTime",{get:function(){if(!a.isFinite(this.programDateTime))return null;var b=a.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),b.prototype.addElementaryStream=function(a){this._elementaryStreams[a]=!0},b.prototype.hasElementaryStream=function(a){return!0===this._elementaryStreams[a]},b.prototype.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;16>c;c++)b[c]=a>>8*(15-c)&255;return b},b.prototype.fragmentDecryptdataFromLevelkey=function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&((c=new e["default"]).method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c},b}();b["default"]=f}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(39),e=c(40),f=c(41),g=c(3),h=c(0),i=c(1),j=c(6).getSelfScope(),k=function(){function a(a,b,c){var d=(void 0===c?{}:c).removePKCS7Padding,e=void 0===d||d;if(this.logEnabled=!0,this.observer=a,this.config=b,this.removePKCS7Padding=e,e)try{var f=j.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch(a){}this.disableWebCrypto=!this.subtle}return a.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},a.prototype.decrypt=function(a,b,c,g){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(h.logger.log("JS AES decrypt"),this.logEnabled=!1);var j=this.decryptor;j||(this.decryptor=j=new f["default"]),j.expandKey(b),g(j.decrypt(a,0,c,this.removePKCS7Padding))}else{this.logEnabled&&(h.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var k=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new e["default"](k,b)),this.fastAesKey.expandKey().then(function(e){new d["default"](k,c).decrypt(a,e)["catch"](function(d){i.onWebCryptoError(d,a,b,c,g)}).then(function(a){g(a)})})["catch"](function(d){i.onWebCryptoError(d,a,b,c,g)})}},a.prototype.onWebCryptoError=function(a,b,c,d,e){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(h.logger.error("decrypting error : "+a.message),this.observer.trigger(i["default"].ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))},a.prototype.destroy=function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)},a}();b["default"]=k},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getMediaSource=function(){return"undefined"!=typeof window?window.MediaSource||window.WebKitMediaSource:void 0}},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(28),f=c(7),g=c(5),h=c(0);b.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var i=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return d(e,c),e.prototype.doTick=function(){},e.prototype.startLoad=function(){},e.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragmentTracker.removeFragment(a)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.State.STOPPED},e.prototype._streamEnded=function(a,b){var c=this.fragCurrent,d=this.fragmentTracker;if(!b.live&&c&&!c.backtracked&&c.sn===b.endSN&&!a.nextStart){var e=d.getState(c);return e===f.FragmentState.PARTIAL||e===f.FragmentState.OK}return!1},e.prototype.onMediaSeeking=function(){var c=this.config,d=this.media,e=this.mediaBuffer,f=this.state,i=d?d.currentTime:null,j=g.BufferHelper.bufferInfo(e||d,i,this.config.maxBufferHole);if(a.isFinite(i)&&h.logger.log("media seeking to "+i.toFixed(3)),f===b.State.FRAG_LOADING){var k=this.fragCurrent;if(0===j.len&&k){var l=c.maxFragLookUpTolerance,m=k.start-l,n=k.start+k.duration+l;m>i||i>n?(k.loader&&(h.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),k.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=b.State.IDLE):h.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else f===b.State.ENDED&&(0===j.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=b.State.IDLE);d&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onHandlerDestroying=function(){this.stopLoad(),c.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=b.State.STOPPED,this.fragmentTracker=null},e}(e["default"]);b["default"]=i}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(3),h=c(0),i=c(17),j=c(32),k=window.performance,l={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},m={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},n=function(b){function c(a){var c=b.call(this,a,e["default"].MANIFEST_LOADING,e["default"].LEVEL_LOADING,e["default"].AUDIO_TRACK_LOADING,e["default"].SUBTITLE_TRACK_LOADING)||this;return c.loaders={},c}return d(c,b),Object.defineProperty(c,"ContextType",{get:function(){return l},enumerable:!0,configurable:!0}),Object.defineProperty(c,"LevelType",{get:function(){return m},enumerable:!0,configurable:!0}),c.canHaveQualityLevels=function(a){return a!==l.AUDIO_TRACK&&a!==l.SUBTITLE_TRACK},c.mapContextToLevelType=function(a){switch(a.type){case l.AUDIO_TRACK:return m.AUDIO;case l.SUBTITLE_TRACK:return m.SUBTITLE;default:return m.MAIN}},c.getResponseUrl=function(a,b){var c=a.url;return void 0!==c&&0!==c.indexOf("data:")||(c=b.url),c},c.prototype.createInternalLoader=function(a){var b=this.hls.config,c=b.pLoader,d=b.loader,e=new(c||d)(b);return a.loader=e,this.loaders[a.type]=e,e},c.prototype.getInternalLoader=function(a){return this.loaders[a.type]},c.prototype.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},c.prototype.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy(),this.resetInternalLoader(a)}},c.prototype.destroy=function(){this.destroyInternalLoaders(),b.prototype.destroy.call(this)},c.prototype.onManifestLoading=function(a){this.load(a.url,{type:l.MANIFEST,level:0,id:null})},c.prototype.onLevelLoading=function(a){this.load(a.url,{type:l.LEVEL,level:a.level,id:a.id})},c.prototype.onAudioTrackLoading=function(a){this.load(a.url,{type:l.AUDIO_TRACK,level:null,id:a.id})},c.prototype.onSubtitleTrackLoading=function(a){this.load(a.url,{type:l.SUBTITLE_TRACK,level:null,id:a.id})},c.prototype.load=function(a,b){var c=this.hls.config;h.logger.debug("Loading playlist of type "+b.type+", level: "+b.level+", id: "+b.id);var d,e,f,g,i=this.getInternalLoader(b);if(i){var j=i.context;if(j&&j.url===a)return h.logger.trace("playlist request ongoing"),!1;h.logger.warn("aborting previous loader for type: "+b.type),i.abort()}switch(b.type){case l.MANIFEST:d=c.manifestLoadingMaxRetry,e=c.manifestLoadingTimeOut,f=c.manifestLoadingRetryDelay,g=c.manifestLoadingMaxRetryTimeout;break;case l.LEVEL:d=0,e=c.levelLoadingTimeOut;break;default:d=c.levelLoadingMaxRetry,e=c.levelLoadingTimeOut,f=c.levelLoadingRetryDelay,g=c.levelLoadingMaxRetryTimeout}i=this.createInternalLoader(b),b.url=a,b.responseType=b.responseType||"";var k={timeout:e,maxRetry:d,retryDelay:f,maxRetryDelay:g},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return h.logger.debug("Calling internal loader delegate for URL: "+a),i.load(b,k,m),!0},c.prototype.loadsuccess=function(a,b,c,d){if(void 0===d&&(d=null),c.isSidxRequest)return this._handleSidxRequest(a,c),void this._handlePlaylistLoaded(a,b,c,d);this.resetInternalLoader(c.type);var e=a.data;b.tload=k.now(),0===e.indexOf("#EXTM3U")?e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(a,b,c,d):this._handleMasterPlaylist(a,b,c,d):this._handleManifestParsingError(a,c,"no EXTM3U delimiter",d)},c.prototype.loaderror=function(a,b,c){void 0===c&&(c=null),this._handleNetworkError(b,c,!1,a)},c.prototype.loadtimeout=function(a,b,c){void 0===c&&(c=null),this._handleNetworkError(b,c,!0)},c.prototype._handleMasterPlaylist=function(a,b,d,f){var g=this.hls,i=a.data,k=c.getResponseUrl(a,d),l=j["default"].parseMasterPlaylist(i,k);if(l.length){var m=l.map(function(a){return{id:a.attrs.AUDIO,codec:a.audioCodec}}),n=j["default"].parseMasterPlaylistMedia(i,k,"AUDIO",m),o=j["default"].parseMasterPlaylistMedia(i,k,"SUBTITLES");if(n.length){var p=!1;n.forEach(function(a){a.url||(p=!0)}),!1===p&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(h.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main"}))}g.trigger(e["default"].MANIFEST_LOADED,{levels:l,audioTracks:n,subtitles:o,url:k,stats:b,networkDetails:f})}else this._handleManifestParsingError(a,d,"no level found in manifest",f)},c.prototype._handleTrackOrLevelPlaylist=function(b,d,f,g){var h=this.hls,i=f.id,m=f.level,n=f.type,o=c.getResponseUrl(b,f),p=a.isFinite(i)?i:0,q=a.isFinite(m)?m:p,r=c.mapContextToLevelType(f),s=j["default"].parseLevelPlaylist(b.data,o,q,r,p);if(s.tload=d.tload,n===l.MANIFEST){var t={url:o,details:s};h.trigger(e["default"].MANIFEST_LOADED,{levels:[t],audioTracks:[],url:o,stats:d,networkDetails:g});
}if(d.tparsed=k.now(),s.needSidxRanges){var u=s.initSegment.url;this.load(u,{isSidxRequest:!0,type:n,level:m,levelDetails:s,id:i,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else f.levelDetails=s,this._handlePlaylistLoaded(b,d,f,g)},c.prototype._handleSidxRequest=function(a,b){var c=i["default"].parseSegmentIndex(new Uint8Array(a.data));if(c){var d=c.references,e=b.levelDetails;d.forEach(function(a,b){var c=a.info,d=e.fragments[b];0===d.byteRange.length&&(d.rawByteRange=String(1+c.end-c.start)+"@"+String(c.start))}),e.initSegment.rawByteRange=String(c.moovEndOffset)+"@0"}},c.prototype._handleManifestParsingError=function(a,b,c,d){this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a.url,reason:c,networkDetails:d})},c.prototype._handleNetworkError=function(a,b,c,d){var f,i;void 0===c&&(c=!1),void 0===d&&(d=null),h.logger.info("A network error occured while loading a "+a.type+"-type playlist");var j=this.getInternalLoader(a);switch(a.type){case l.MANIFEST:f=c?g.ErrorDetails.MANIFEST_LOAD_TIMEOUT:g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case l.LEVEL:f=c?g.ErrorDetails.LEVEL_LOAD_TIMEOUT:g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case l.AUDIO_TRACK:f=c?g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;default:i=!1}j&&(j.abort(),this.resetInternalLoader(a.type));var k={type:g.ErrorTypes.NETWORK_ERROR,details:f,fatal:i,url:j.url,loader:j,context:a,networkDetails:b};d&&(k.response=d),this.hls.trigger(e["default"].ERROR,k)},c.prototype._handlePlaylistLoaded=function(a,b,d,f){var g=d.type,h=d.level,i=d.id,j=d.levelDetails;if(j.targetduration)if(c.canHaveQualityLevels(d.type))this.hls.trigger(e["default"].LEVEL_LOADED,{details:j,level:h||0,id:i||0,stats:b,networkDetails:f});else switch(g){case l.AUDIO_TRACK:this.hls.trigger(e["default"].AUDIO_TRACK_LOADED,{details:j,id:i,stats:b,networkDetails:f});break;case l.SUBTITLE_TRACK:this.hls.trigger(e["default"].SUBTITLE_TRACK_LOADED,{details:j,id:i,stats:b,networkDetails:f})}else this._handleManifestParsingError(a,d,"invalid target duration",f)},c}(f["default"]);b["default"]=n}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(0),e=c(1),f=Math.pow(2,32)-1,g=function(){function a(a,b){this.observer=a,this.remuxer=b}return a.prototype.resetTimeStamp=function(a){this.initPTS=a},a.prototype.resetInitSegment=function(b,c,d,f){if(b&&b.byteLength){var g=this.initData=a.parseInitSegment(b);null==c&&(c="mp4a.40.5"),null==d&&(d="avc1.42e01e");var h={};g.audio&&g.video?h.audiovideo={container:"video/mp4",codec:c+","+d,initSegment:f?b:null}:(g.audio&&(h.audio={container:"audio/mp4",codec:c,initSegment:f?b:null}),g.video&&(h.video={container:"video/mp4",codec:d,initSegment:f?b:null})),this.observer.trigger(e["default"].FRAG_PARSING_INIT_SEGMENT,{tracks:h})}else c&&(this.audioCodec=c),d&&(this.videoCodec=d)},a.probe=function(b){return a.findBox({data:b,start:0,end:Math.min(b.length,16384)},["moof"]).length>0},a.bin2str=function(a){return String.fromCharCode.apply(null,a)},a.readUint16=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<8|a[b+1];return 0>c?65536+c:c},a.readUint32=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return 0>c?4294967296+c:c},a.writeUint32=function(a,b,c){a.data&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c},a.findBox=function(b,c){var d,e,f,g,h,i,j,k=[];if(b.data?(i=b.start,g=b.end,b=b.data):(i=0,g=b.byteLength),!c.length)return null;for(d=i;g>d;)e=a.readUint32(b,d),f=a.bin2str(b.subarray(d+4,d+8)),j=e>1?d+e:g,f===c[0]&&(1===c.length?k.push({data:b,start:d+8,end:j}):(h=a.findBox({data:b,start:d+8,end:j},c.slice(1))).length&&(k=k.concat(h))),d=j;return k},a.parseSegmentIndex=function(b){var c,d=a.findBox(b,["moov"])[0],e=d?d.end:null,f=0,g=a.findBox(b,["sidx"]);if(!g||!g[0])return null;c=[];var h=(g=g[0]).data[0];f=0===h?8:16;var i=a.readUint32(g,f);f+=4,f+=0===h?8:16,f+=2;var j=g.end+0,k=a.readUint16(g,f);f+=2;for(var l=0;k>l;l++){var m=f,n=a.readUint32(g,m);m+=4;var o=2147483647&n;if(1===(2147483648&n)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var p=a.readUint32(g,m);m+=4,c.push({referenceSize:o,subsegmentDuration:p,info:{duration:p/i,start:j,end:j+o-1}}),j+=o,f=m+=4}return{earliestPresentationTime:0,timescale:i,version:h,referencesCount:k,references:c,moovEndOffset:e}},a.parseInitSegment=function(b){var c=[];return a.findBox(b,["moov","trak"]).forEach(function(b){var e=a.findBox(b,["tkhd"])[0];if(e){var f=e.data[e.start],g=0===f?12:20,h=a.readUint32(e,g),i=a.findBox(b,["mdia","mdhd"])[0];if(i){g=0===(f=i.data[i.start])?12:20;var j=a.readUint32(i,g),k=a.findBox(b,["mdia","hdlr"])[0];if(k){var l={soun:"audio",vide:"video"}[a.bin2str(k.data.subarray(k.start+8,k.start+12))];if(l){var m=a.findBox(b,["mdia","minf","stbl","stsd"]);if(m.length){m=m[0];var n=a.bin2str(m.data.subarray(m.start+12,m.start+16));d.logger.log("MP4Demuxer:"+l+":"+n+" found")}c[h]={timescale:j,type:l},c[l]={timescale:j,id:h}}}}}}),c},a.getStartDTS=function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f;return e=a.readUint32(d,4),f=b[e].timescale||9e4,a.findBox(c,["tfdt"]).map(function(b){var c,d;return c=b.data[b.start],d=a.readUint32(b,4),1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8)),d})[0]/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0},a.offsetStartDTS=function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){var g=a.readUint32(e,4),h=b[g].timescale||9e4;a.findBox(c,["tfdt"]).map(function(b){var c=b.data[b.start],e=a.readUint32(b,4);if(0===c)a.writeUint32(b,4,e-d*h);else{e*=Math.pow(2,32),e+=a.readUint32(b,8),e-=d*h,e=Math.max(e,0);var g=Math.floor(e/(f+1)),i=Math.floor(e%(f+1));a.writeUint32(b,4,g),a.writeUint32(b,8,i)}})})})},a.prototype.append=function(b,c,d,f){var g=this.initData;g||(this.resetInitSegment(b,this.audioCodec,this.videoCodec,!1),g=this.initData);var h,i=this.initPTS;if(void 0===i){var j=a.getStartDTS(g,b);this.initPTS=i=j-c,this.observer.trigger(e["default"].INIT_PTS_FOUND,{initPTS:i})}a.offsetStartDTS(g,b,i),h=a.getStartDTS(g,b),this.remuxer.remux(g.audio,g.video,null,null,h,d,f,b)},a.prototype.destroy=function(){},a}();b["default"]=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(9),e=function(){function a(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(a.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=d.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),a}();b["default"]=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};b.isCodecType=function(a,b){var c=d[b];return!!c&&!0===c[a.slice(0,4)]},b.isCodecSupportedInMp4=function(a,b){return window.MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c(38),e=c(1),f=c(21),g=c(0),h=c(3),i=c(14),j=c(6),k=c(24),l=j.getSelfScope(),m=i.getMediaSource(),n=function(){function b(a,b){var c=this;this.hls=a,this.id=b;var i=this.observer=new k.Observer,j=a.config,n=function(b,d){(d=d||{}).frag=c.frag,d.id=c.id,a.trigger(b,d)};i.on(e["default"].FRAG_DECRYPTED,n),i.on(e["default"].FRAG_PARSING_INIT_SEGMENT,n),i.on(e["default"].FRAG_PARSING_DATA,n),i.on(e["default"].FRAG_PARSED,n),i.on(e["default"].ERROR,n),i.on(e["default"].FRAG_PARSING_METADATA,n),i.on(e["default"].FRAG_PARSING_USERDATA,n),i.on(e["default"].INIT_PTS_FOUND,n);var o={mp4:m.isTypeSupported("video/mp4"),mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(j.enableWorker&&"undefined"!=typeof Worker){g.logger.log("demuxing in webworker");var q=void 0;try{q=this.w=d(52),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(b){a.trigger(e["default"].ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:b.message+" ("+b.filename+":"+b.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:o,vendor:p,id:b,config:JSON.stringify(j)})}catch(a){g.logger.warn("Error in worker:",a),g.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&l.URL.revokeObjectURL(q.objectURL),this.demuxer=new f["default"](i,o,j,p),this.w=void 0}}else this.demuxer=new f["default"](i,o,j,p)}return b.prototype.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)},b.prototype.push=function(b,c,d,e,f,h,i,j){var k=this.w,l=a.isFinite(f.startPTS)?f.startPTS:f.start,m=f.decryptdata,n=this.frag,o=!(n&&f.cc===n.cc),p=!(n&&f.level===n.level),q=n&&f.sn===n.sn+1,r=!p&&q;if(o&&g.logger.log(this.id+":discontinuity detected"),p&&g.logger.log(this.id+":switch detected"),this.frag=f,k)k.postMessage({cmd:"demux",data:b,decryptdata:m,initSegment:c,audioCodec:d,videoCodec:e,timeOffset:l,discontinuity:o,trackSwitch:p,contiguous:r,duration:h,accurateTimeOffset:i,defaultInitPTS:j},b instanceof ArrayBuffer?[b]:[]);else{var s=this.demuxer;s&&s.push(b,m,c,d,e,l,o,p,r,h,i,j)}},b.prototype.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":l.URL.revokeObjectURL(this.w.objectURL);break;case e["default"].FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},b}();b["default"]=n}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d,e=c(1),f=c(3),g=c(13),h=c(42),i=c(17),j=c(43),k=c(46),l=c(47),m=c(50),n=c(6),o=c(0),p=n.getSelfScope();try{d=p.performance.now.bind(p.performance)}catch(a){o.logger.debug("Unable to use Performance API on this environment"),d=p.Date.now}var q=function(){function a(a,b,c,d){this.observer=a,this.typeSupported=b,this.config=c,this.vendor=d}return a.prototype.destroy=function(){var a=this.demuxer;a&&a.destroy()},a.prototype.push=function(a,b,c,f,h,i,j,k,l,m,n,o){var p=this;if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var q=this.decrypter;null==q&&(q=this.decrypter=new g["default"](this.observer,this.config));var r=d();q.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var g=d();p.observer.trigger(e["default"].FRAG_DECRYPTED,{stats:{tstart:r,tdecrypt:g}}),p.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),f,h,i,j,k,l,m,n,o)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),f,h,i,j,k,l,m,n,o)},a.prototype.pushDecrypted=function(a,b,c,d,g,n,o,p,q,r,s,t){var u=this.demuxer;if(!u||(o||p)&&!this.probe(a)){for(var v=this.observer,w=this.typeSupported,x=this.config,y=[{demux:j["default"],remux:l["default"]},{demux:i["default"],remux:m["default"]},{demux:h["default"],remux:l["default"]},{demux:k["default"],remux:l["default"]}],z=0,A=y.length;A>z;z++){var B=y[z],C=B.demux.probe;if(C(a)){var D=this.remuxer=new B.remux(v,x,w,this.vendor);u=new B.demux(v,D,x,w),this.probe=C;break}}if(!u)return void v.trigger(e["default"].ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=u}var E=this.remuxer;(o||p)&&(u.resetInitSegment(c,d,g,r),E.resetInitSegment()),o&&(u.resetTimeStamp(t),E.resetTimeStamp(t)),"function"==typeof u.setDecryptData&&u.setDecryptData(b),u.append(a,n,q,s)},a}();b["default"]=q},function(a,b,c){"use strict";function d(a,b,c,d){var e,f,g,h,i,m=navigator.userAgent.toLowerCase(),n=d,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=1+((192&b[c+2])>>>6),(f=(60&b[c+2])>>>2)>o.length-1?void a.trigger(l["default"].ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(h=(1&b[c+2])<<2,h|=(192&b[c+3])>>>6,j.logger.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+f+"["+o[f]+"Hz],channelConfig:"+h),/firefox/i.test(m)?f>=6?(e=5,i=new Array(4),g=f-3):(e=2,i=new Array(2),g=f):-1!==m.indexOf("android")?(e=2,i=new Array(2),g=f):(e=5,i=new Array(4),d&&(-1!==d.indexOf("mp4a.40.29")||-1!==d.indexOf("mp4a.40.5"))||!d&&f>=6?g=f-3:((d&&-1!==d.indexOf("mp4a.40.2")&&(f>=6&&1===h||/vivaldi/i.test(m))||!d&&1===h)&&(e=2,i=new Array(2)),g=f)),i[0]=e<<3,i[0]|=(14&f)>>1,i[1]|=(1&f)<<7,i[1]|=h<<3,5===e&&(i[1]|=(14&g)>>1,i[2]=(1&g)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:o[f],channelCount:h,codec:"mp4a.40."+e,manifestCodec:n})}function e(a,b){return 255===a[b]&&240==(246&a[b+1])}function f(a,b){return 1&a[b+1]?7:9}function g(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function h(a){return 9216e4/a}function i(a,b,c,d,e){var h,i,j=a.length;return h=f(a,b),i=g(a,b),(i-=h)>0&&j>=b+h+i?{headerLength:h,frameLength:i,stamp:c+d*e}:void 0}Object.defineProperty(b,"__esModule",{value:!0});var j=c(0),k=c(3),l=c(1);b.getAudioConfig=d,b.isHeaderPattern=e,b.getHeaderLength=f,b.getFullFrameLength=g,b.isHeader=function(a,b){return!!(b+1<a.length&&e(a,b))},b.probe=function(a,b){if(b+1<a.length&&e(a,b)){var c=f(a,b);b+5<a.length&&(c=g(a,b));var d=b+c;if(d===a.length||d+1<a.length&&e(a,d))return!0}return!1},b.initTrackConfig=function(a,b,c,e,f){if(!a.samplerate){var g=d(b,c,e,f);a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,j.logger.log("parsed codec:"+a.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)}},b.getFrameDuration=h,b.parseFrameHeader=i,b.appendFrame=function(a,b,c,d,e){var f=i(b,c,d,e,h(a.samplerate));if(f){var g=f.stamp,j=f.headerLength,k=f.frameLength,l={unit:b.subarray(c+j,c+j+k),pts:g,dts:g};return a.samples.push(l),a.len+=k,{sample:l,length:k+j}}}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(a,b,c,d,e){if(!(c+24>b.length)){var f=this.parseHeader(b,c);if(f&&c+f.frameLength<=b.length){var g=d+e*(9e4*f.samplesPerFrame/f.sampleRate),h={unit:b.subarray(c,c+f.frameLength),pts:g,dts:g};return a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(h),a.len+=f.frameLength,{sample:h,length:f.frameLength}}}},parseHeader:function(a,b){var c=a[b+1]>>3&3,e=a[b+1]>>1&3,f=a[b+2]>>4&15,g=a[b+2]>>2&3,h=a[b+2]>>1&1;if(1!==c&&0!==f&&15!==f&&3!==g){var i=3===c?3-e:3===e?3:4,j=1e3*d.BitratesMap[14*i+f-1],k=3===c?0:2===c?1:2,l=d.SamplingRateMap[3*k+g],m=a[b+3]>>6==3?1:2,n=d.SamplesCoefficients[c][e],o=d.BytesInSlot[e],p=8*n*o;return{sampleRate:l,channelCount:m,frameLength:parseInt(n*j/l+h,10)*o,samplesPerFrame:p}}},isHeaderPattern:function(a,b){return 255===a[b]&&224==(224&a[b+1])&&0!=(6&a[b+1])},isHeader:function(a,b){return!!(b+1<a.length&&this.isHeaderPattern(a,b))},probe:function(a,b){if(b+1<a.length&&this.isHeaderPattern(a,b)){var c=this.parseHeader(a,b),d=4;c&&c.frameLength&&(d=c.frameLength);var e=b+d;if(e===a.length||e+1<a.length&&this.isHeaderPattern(a,e))return!0}return!1}};b["default"]=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.trigger=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.emit.apply(this,[a,a].concat(b))},b}(c(51).EventEmitter);b.Observer=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]={toString:function(a){for(var b="",c=a.length,d=0;c>d;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}}},function(a,b,c){"use strict";(function(a){function d(a,b){for(var c=null,d=0;d<a.length;d+=1){var e=a[d];if(e&&e.cc===b){c=e;break}}return c}function e(a,b,c){var d=!1;return b&&b.details&&c&&(c.endCC>c.startCC||a&&a.cc<c.startCC)&&(d=!0),d}function f(a,b){var c=a.fragments,e=b.fragments;if(e.length&&c.length){var f=d(c,e[0].cc);if(f&&(!f||f.startPTS))return f;k.logger.log("No frag in previous level to align on")}else k.logger.log("No fragments to align")}function g(a,b){b.fragments.forEach(function(b){if(b){var c=b.start+a;b.start=b.startPTS=c,b.endPTS=c+b.duration}}),b.PTSKnown=!0}function h(a,b,c){if(e(a,c,b)){var d=f(c.details,b);d&&(k.logger.log("Adjusting PTS using last level due to CC increase within current level"),g(d.start,b))}}function i(b,c){if(c&&c.fragments.length){if(!b.hasProgramDateTime||!c.hasProgramDateTime)return;var d=c.fragments[0].programDateTime,e=(b.fragments[0].programDateTime-d)/1e3+c.fragments[0].start;a.isFinite(e)&&(k.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),g(e,b))}}Object.defineProperty(b,"__esModule",{value:!0});var j=c(10),k=c(0);b.findFirstFragWithCC=d,b.findFragWithCC=function(a,b){return j["default"].search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})},b.shouldAlignOnDiscontinuities=e,b.findDiscontinuousReferenceFrag=f,b.adjustPts=g,b.alignStream=function(a,b,c){h(a,c,b),!c.PTSKnown&&b&&i(c,b.details)},b.alignDiscontinuities=h,b.alignPDT=i}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){function d(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0);var d=Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-d<=a?1:c.start-d>a&&c.start?-1:0}function e(a,b,c){var d=1e3*Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.endProgramDateTime-d>a}Object.defineProperty(b,"__esModule",{value:!0});var f=c(10);b.findFragmentByPDT=function(b,c,d){if(!Array.isArray(b)||!b.length||!a.isFinite(c))return null;if(c<b[0].programDateTime)return null;if(c>=b[b.length-1].endProgramDateTime)return null;d=d||0;for(var f=0;f<b.length;++f){var g=b[f];if(e(c,d,g))return g}return null},b.findFragmentByPTS=function(a,b,c,e){void 0===c&&(c=0),void 0===e&&(e=0);var g=a?b[a.sn-b[0].sn+1]:null;return g&&!d(c,e,g)?g:f["default"].search(b,d.bind(null,c,e))},b.fragmentWithinToleranceTest=d,b.pdtWithinToleranceTest=e}).call(this,c(2).Number)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=function(a){function b(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=a.apply(this,[b].concat(c))||this;return e._tickInterval=null,e._tickTimer=null,e._tickCallCount=0,e._boundTick=e.tick.bind(e),e}return d(b,a),b.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.prototype.hasInterval=function(){return!!this._tickInterval},b.prototype.hasNextTick=function(){return!!this._tickTimer},b.prototype.setInterval=function(a){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,a),!0)},b.prototype.clearInterval=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},b.prototype.doTick=function(){},b}(c(4)["default"]);b["default"]=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.sendAddTrackEvent=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(a){(c=document.createEvent("Event")).initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},b.clearCurrentCues=function(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}},function(a,b,c){"use strict";function d(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new j,this.regionList=[]}function e(){this.values=Object.create(null)}function f(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);2===g.length&&b(g[0],g[1])}}function g(a,b,c){function d(){var b=function(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}(a);if(null===b)throw new Error("Malformed timestamp: "+h);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function g(){a=a.replace(/^\s+/,"")}var h=a;if(g(),b.startTime=d(),g(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+h);a=a.substr(3),g(),b.endTime=d(),g(),function(a,b){var d=new e;f(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",l,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",l,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",l,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var g=d.get("line","auto");"auto"===g&&-1===k.line&&(g=-1),b.line=g,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",l);var h=d.get("position","auto");"auto"===h&&50===k.position&&(h="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=h}(a,b)}function h(a){return a.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(b,"__esModule",{value:!0});var i=c(69),j=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};e.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){return!!(b.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(b=parseFloat(b))>=0&&100>=b)&&(this.set(a,b),!0)}};var k=new i["default"](0,0,0),l="middle"===k.align?"middle":"center";b.fixLineBreaks=h,d.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=h(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){f(a,function(a,b){},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e=void 0;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;var j=(e=b()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!j||!j[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var k=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(k?k=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new i["default"](0,0,""),d.state="CUE",-1===e.indexOf("-->")){d.cue.id=e;continue}case"CUE":try{g(e,d.cue,d.regionList)}catch(a){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var l=-1!==e.indexOf("-->");if(!e||l&&(k=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(a){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(a){throw a}return this.onflush&&this.onflush(),this}},b["default"]=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(9),f=c(3),g=c(16),h=c(35),i=c(36),j=c(7),k=c(37),l=c(55),m=c(56),n=c(57),o=c(0),p=c(58),q=c(1),r=function(a){function b(c){void 0===c&&(c={});var d=a.call(this)||this,e=b.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var f in e)f in c||(c[f]=e[f]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');o.enableLogs(c.debug),d.config=c,d._autoLevelCapping=-1;var n=d.abrController=new c.abrController(d),p=new c.bufferController(d),q=new c.capLevelController(d),r=new c.fpsController(d),s=new g["default"](d),t=new h["default"](d),u=new i["default"](d),v=new m["default"](d),w=d.levelController=new l["default"](d),x=new j.FragmentTracker(d),y=[w,d.streamController=new k["default"](d,x)],z=c.audioStreamController;z&&y.push(new z(d,x)),d.networkControllers=y;var A=[s,t,u,n,p,q,r,v,x];if(z=c.audioTrackController){var B=new z(d);d.audioTrackController=B,A.push(B)}if(z=c.subtitleTrackController){var C=new z(d);d.subtitleTrackController=C,y.push(C)}if(z=c.emeController){var D=new z(d);d.emeController=D,A.push(D)}return(z=c.subtitleStreamController)&&y.push(new z(d,x)),(z=c.timelineController)&&A.push(new z(d)),d.coreComponents=A,d}return d(b,a),Object.defineProperty(b,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),b.isSupported=function(){return n.isSupported()},Object.defineProperty(b,"Events",{get:function(){return q["default"]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorTypes",{get:function(){return f.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorDetails",{get:function(){return f.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultConfig",{get:function(){return b.defaultConfig?b.defaultConfig:p.hlsDefaultConfig},set:function(a){b.defaultConfig=a},enumerable:!0,configurable:!0}),b.prototype.destroy=function(){o.logger.log("destroy"),this.trigger(q["default"].DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},b.prototype.attachMedia=function(a){o.logger.log("attachMedia"),this.media=a,this.trigger(q["default"].MEDIA_ATTACHING,{media:a})},b.prototype.detachMedia=function(){o.logger.log("detachMedia"),this.trigger(q["default"].MEDIA_DETACHING),this.media=null},b.prototype.loadSource=function(a){a=e.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),o.logger.log("loadSource:"+a),this.url=a,this.trigger(q["default"].MANIFEST_LOADING,{url:a})},b.prototype.startLoad=function(a){void 0===a&&(a=-1),o.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},b.prototype.stopLoad=function(){o.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},b.prototype.swapAudioCodec=function(){o.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.prototype.recoverMediaError=function(){o.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)},Object.defineProperty(b.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(a){o.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(a){o.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(a){o.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){o.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(a){o.logger.log("set startLevel:"+a),-1!==a&&(a=Math.max(a,this.minAutoLevel)),this.levelController.startLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(a){o.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"minAutoLevel",{get:function(){for(var a=this.levels,b=this.config.minAutoBitrate,c=a?a.length:0,d=0;c>d;d++)if((a[d].realBitrate?Math.max(a[d].realBitrate,a[d].bitrate):a[d].bitrate)>b)return d;
return 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxAutoLevel",{get:function(){var a=this.levels,b=this.autoLevelCapping;return-1===b&&a&&a.length?a.length-1:b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextAutoLevel",{get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(a){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTracks",{get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTrack",{get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleTracks",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleTrack",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleDisplay",{get:function(){var a=this.subtitleTrackController;return!!a&&a.subtitleDisplay},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)},enumerable:!0,configurable:!0}),b}(c(24).Observer);b["default"]=r},function(a,b,c){"use strict";(function(a){function d(b,c){b.rawProgramDateTime?b.programDateTime=Date.parse(b.rawProgramDateTime):c&&c.programDateTime&&(b.programDateTime=c.endProgramDateTime),a.isFinite(b.programDateTime)||(b.programDateTime=null,b.rawProgramDateTime=null)}Object.defineProperty(b,"__esModule",{value:!0});var e=c(9),f=c(12),g=c(33),h=c(18),i=c(34),j=c(0),k=c(19),l=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,m=/#EXT-X-MEDIA:(.*)/g,n=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),o=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,p=/\.(mp4|m4s|m4v|m4a)$/i,q=function(){function b(){}return b.findGroup=function(a,b){if(!a)return null;for(var c=null,d=0;d<a.length;d++){var e=a[d];e.id===b&&(c=e)}return c},b.convertAVC1ToAVCOTI=function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b},b.resolve=function(a,b){return e.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},b.parseMasterPlaylist=function(a,c){function d(a,b){["video","audio"].forEach(function(c){var d=a.filter(function(a){return k.isCodecType(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return-1===d.indexOf(a)})}}),b.unknownCodecs=a}var e,f=[];for(l.lastIndex=0;null!=(e=l.exec(a));){var g={},h=g.attrs=new i["default"](e[1]);g.url=b.resolve(e[2],c);var j=h.decimalResolution("RESOLUTION");j&&(g.width=j.width,g.height=j.height),g.bitrate=h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),g.name=h.NAME,d([].concat((h.CODECS||"").split(/[ ,]+/)),g),g.videoCodec&&-1!==g.videoCodec.indexOf("avc1")&&(g.videoCodec=b.convertAVC1ToAVCOTI(g.videoCodec)),f.push(g)}return f},b.parseMasterPlaylistMedia=function(a,c,d,e){var f;void 0===e&&(e=[]);var g=[],h=0;for(m.lastIndex=0;null!==(f=m.exec(a));){var j={},k=new i["default"](f[1]);if(k.TYPE===d){if(j.groupId=k["GROUP-ID"],j.name=k.NAME,j.type=d,j["default"]="YES"===k.DEFAULT,j.autoselect="YES"===k.AUTOSELECT,j.forced="YES"===k.FORCED,k.URI&&(j.url=b.resolve(k.URI,c)),j.lang=k.LANGUAGE,j.name||(j.name=j.lang),e.length){var l=b.findGroup(e,j.groupId);j.audioCodec=l?l.codec:e[0].codec}j.id=h++,g.push(j)}}return g},b.parseLevelPlaylist=function(b,c,e,k,l){var m,q,r=0,s=0,t=new g["default"](c),u=new h["default"],v=0,w=null,x=new f["default"],y=null;for(n.lastIndex=0;null!==(m=n.exec(b));){var z=m[1];if(z){x.duration=parseFloat(z);var A=(" "+m[2]).slice(1);x.title=A||null,x.tagList.push(A?["INF",z,A]:["INF",z])}else if(m[3]){if(a.isFinite(x.duration)){var B=r++;x.type=k,x.start=s,x.levelkey=u,x.sn=B,x.level=e,x.cc=v,x.urlId=l,x.baseurl=c,x.relurl=(" "+m[3]).slice(1),d(x,w),t.fragments.push(x),w=x,s+=x.duration,x=new f["default"]}}else if(m[4]){if(x.rawByteRange=(" "+m[4]).slice(1),w){var C=w.byteRangeEndOffset;C&&(x.lastByteRangeEndOffset=C)}}else if(m[5])x.rawProgramDateTime=(" "+m[5]).slice(1),x.tagList.push(["PROGRAM-DATE-TIME",x.rawProgramDateTime]),null===y&&(y=t.fragments.length);else{for(m=m[0].match(o),q=1;q<m.length&&void 0===m[q];q++);var D=(" "+m[q+1]).slice(1),E=(" "+m[q+2]).slice(1);switch(m[q]){case"#":x.tagList.push(E?[D,E]:[D]);break;case"PLAYLIST-TYPE":t.type=D.toUpperCase();break;case"MEDIA-SEQUENCE":r=t.startSN=parseInt(D);break;case"TARGETDURATION":t.targetduration=parseFloat(D);break;case"VERSION":t.version=parseInt(D);break;case"EXTM3U":break;case"ENDLIST":t.live=!1;break;case"DIS":v++,x.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":v=parseInt(D);break;case"KEY":var F=D,G=new i["default"](F),H=G.enumeratedString("METHOD"),I=G.URI,J=G.hexadecimalInteger("IV");H&&(u=new h["default"],I&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(H)>=0&&(u.method=H,u.baseuri=c,u.reluri=I,u.key=null,u.iv=J));break;case"START":var K=D,L=new i["default"](K).decimalFloatingPoint("TIME-OFFSET");a.isFinite(L)&&(t.startTimeOffset=L);break;case"MAP":var M=new i["default"](D);x.relurl=M.URI,x.rawByteRange=M.BYTERANGE,x.baseurl=c,x.level=e,x.type=k,x.sn="initSegment",t.initSegment=x,(x=new f["default"]).rawProgramDateTime=t.initSegment.rawProgramDateTime;break;default:j.logger.warn("line parsed but not handled: "+m)}}}return(x=w)&&!x.relurl&&(t.fragments.pop(),s-=x.duration),t.totalduration=s,t.averagetargetduration=s/t.fragments.length,t.endSN=r-1,t.startCC=t.fragments[0]?t.fragments[0].cc:0,t.endCC=v,!t.initSegment&&t.fragments.length&&t.fragments.every(function(a){return p.test(a.relurl)})&&(j.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(x=new f["default"]).relurl=t.fragments[0].relurl,x.baseurl=c,x.level=e,x.type=k,x.sn="initSegment",t.initSegment=x,t.needSidxRanges=!0),y&&function(a,b){for(var c=a[b],d=b-1;d>=0;d--){var e=a[d];e.programDateTime=c.programDateTime-1e3*e.duration,c=e}}(t.fragments,y),t},b}();b["default"]=q}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function b(a){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=a,this.version=null}return Object.defineProperty(b.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!a.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),b}();b["default"]=c}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c=/^(\d+)x(\d+)$/,d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,e=function(){function b(a){for(var c in"string"==typeof a&&(a=b.parseAttrList(a)),a)a.hasOwnProperty(c)&&(this[c]=a[c])}return b.prototype.decimalInteger=function(b){var c=parseInt(this[b],10);return c>a.MAX_SAFE_INTEGER?1/0:c},b.prototype.hexadecimalInteger=function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null},b.prototype.hexadecimalIntegerAsNumber=function(b){var c=parseInt(this[b],16);return c>a.MAX_SAFE_INTEGER?1/0:c},b.prototype.decimalFloatingPoint=function(a){return parseFloat(this[a])},b.prototype.enumeratedString=function(a){return this[a]},b.prototype.decimalResolution=function(a){var b=c.exec(this[a]);return null!==b?{width:parseInt(b[1],10),height:parseInt(b[2],10)}:void 0},b.parseAttrList=function(a){var b,c={};for(d.lastIndex=0;null!==(b=d.exec(a));){var e=b[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1)),c[b[1]]=e}return c},b}();b["default"]=e}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(3),h=c(0),i=function(b){function c(a){var c=b.call(this,a,e["default"].FRAG_LOADING)||this;return c.loaders={},c}return d(c,b),c.prototype.destroy=function(){var a=this.loaders;for(var c in a){var d=a[c];d&&d.destroy()}this.loaders={},b.prototype.destroy.call(this)},c.prototype.onFragLoading=function(b){var c=b.frag,d=c.type,e=this.loaders,f=this.hls.config,g=f.fLoader,i=f.loader;c.loaded=0;var j,k,l,m=e[d];m&&(h.logger.warn("abort previous fragment loader for type: "+d),m.abort()),m=e[d]=c.loader=f.fLoader?new g(f):new i(f),j={url:c.url,frag:c,responseType:"arraybuffer",progressData:!1};var n=c.byteRangeStartOffset,o=c.byteRangeEndOffset;a.isFinite(n)&&a.isFinite(o)&&(j.rangeStart=n,j.rangeEnd=o),k={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},m.load(j,k,l)},c.prototype.loadsuccess=function(a,b,c,d){void 0===d&&(d=null);var f=a.data,g=c.frag;g.loader=void 0,this.loaders[g.type]=void 0,this.hls.trigger(e["default"].FRAG_LOADED,{payload:f,frag:g,stats:b,networkDetails:d})},c.prototype.loaderror=function(a,b,c){void 0===c&&(c=null);var d=b.frag,f=d.loader;f&&f.abort(),this.loaders[d.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})},c.prototype.loadtimeout=function(a,b,c){void 0===c&&(c=null);var d=b.frag,f=d.loader;f&&f.abort(),this.loaders[d.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})},c.prototype.loadprogress=function(a,b,c,d){void 0===d&&(d=null);var f=b.frag;f.loaded=a.loaded,this.hls.trigger(e["default"].FRAG_LOAD_PROGRESS,{frag:f,stats:a,networkDetails:d})},c}(f["default"]);b["default"]=i}).call(this,c(2).Number)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(3),h=c(0),i=function(a){function b(b){var c=a.call(this,b,e["default"].KEY_LOADING)||this;return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return d(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},f["default"].prototype.destroy.call(this)},b.prototype.onKeyLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],f=b.decryptdata,g=f.uri;if(g!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;d&&(h.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new i.loader(i),this.decrypturl=g,this.decryptkey=null;var j,k,l;j={url:g,frag:b,responseType:"arraybuffer"},k={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(j,k,l)}else this.decryptkey&&(f.key=this.decryptkey,this.hls.trigger(e["default"].KEY_LOADED,{frag:b}))},b.prototype.loadsuccess=function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(e["default"].KEY_LOADED,{frag:d})},b.prototype.loaderror=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.prototype.loadtimeout=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(e["default"].ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},b}(f["default"]);b["default"]=i},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(10),f=c(5),g=c(20),h=c(1),i=c(7),j=c(12),k=c(16),l=c(8),m=c(25),n=c(3),o=c(0),p=c(26),q=c(27),r=c(54),s=c(15),t=function(b){function c(a,c){var d=b.call(this,a,h["default"].MEDIA_ATTACHED,h["default"].MEDIA_DETACHING,h["default"].MANIFEST_LOADING,h["default"].MANIFEST_PARSED,h["default"].LEVEL_LOADED,h["default"].KEY_LOADED,h["default"].FRAG_LOADED,h["default"].FRAG_LOAD_EMERGENCY_ABORTED,h["default"].FRAG_PARSING_INIT_SEGMENT,h["default"].FRAG_PARSING_DATA,h["default"].FRAG_PARSED,h["default"].ERROR,h["default"].AUDIO_TRACK_SWITCHING,h["default"].AUDIO_TRACK_SWITCHED,h["default"].BUFFER_CREATED,h["default"].BUFFER_APPENDED,h["default"].BUFFER_FLUSHED)||this;return d.fragmentTracker=c,d.config=a.config,d.audioCodecSwap=!1,d._state=s.State.STOPPED,d.stallReported=!1,d.gapController=null,d}return d(c,b),c.prototype.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&-1===a&&(o.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=s.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=s.State.STOPPED},c.prototype.stopLoad=function(){this.forceStartLoad=!1,b.prototype.stopLoad.call(this)},c.prototype.doTick=function(){switch(this.state){case s.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case s.State.IDLE:this._doTickIdle();break;case s.State.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=s.State.IDLE);break;case s.State.FRAG_LOADING_WAITING_RETRY:var b=window.performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(o.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=s.State.IDLE);break;case s.State.ERROR:case s.State.STOPPED:case s.State.FRAG_LOADING:case s.State.PARSING:case s.State.PARSED:case s.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},c.prototype._doTickIdle=function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&(c||!this.startFragRequested&&b.startFragPrefetch)){var d;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,g=this.levels[e];if(g){var i,j=g.bitrate;i=j?Math.max(8*b.maxBufferSize/j,b.maxBufferLength):b.maxBufferLength,i=Math.min(i,b.maxMaxBufferLength);var k=f.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),l=k.len;if(!(l>=i)){o.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+i.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var m=g.details;if(!m||m.live&&this.levelLastLoaded!==e)this.state=s.State.WAITING_LEVEL;else{if(this._streamEnded(k,m)){var n={};return this.altAudio&&(n.type="video"),this.hls.trigger(h["default"].BUFFER_EOS,n),void(this.state=s.State.ENDED)}this._fetchPayloadOrEos(d,k,m)}}}}},c.prototype._fetchPayloadOrEos=function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h,i=f[0].start,j=f[g-1].start+f[g-1].duration,k=b.end;if(c.initSegment&&!c.initSegment.data)h=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(l>g)return void o.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(null===(h=this._ensureFragmentAtLivePoint(c,k,i,j,d,f,g)))return}else i>k&&(h=f[0]);h||(h=this._findFragment(i,d,g,f,k,j,c)),h&&(h.encrypted?(o.logger.log("Loading key for "+h.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e),this._loadKey(h)):(o.logger.log("Loading "+h.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e+", currentTime:"+a.toFixed(3)+",bufferEnd:"+k.toFixed(3)),this._loadFragment(h)))}},c.prototype._ensureFragmentAtLivePoint=function(a,b,c,d,f,g,h){var i,j=this.hls.config,k=this.media,l=void 0!==j.liveMaxLatencyDuration?j.liveMaxLatencyDuration:j.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-j.maxFragLookUpTolerance,d-l)){var m=this.liveSyncPosition=this.computeLivePosition(c,a);o.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+m.toFixed(3)),b=m,k&&k.readyState&&k.duration>m&&(k.currentTime=m),this.nextLoadPosition=m}if(a.PTSKnown&&b>d&&k&&k.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(f)if(a.hasProgramDateTime)o.logger.log("live playlist, switching playlist, load frag with same PDT: "+f.programDateTime),i=q.findFragmentByPDT(g,f.endProgramDateTime,j.maxFragLookUpTolerance);else{var n=f.sn+1;if(n>=a.startSN&&n<=a.endSN){var p=g[n-a.startSN];f.cc===p.cc&&(i=p,o.logger.log("live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=e["default"].search(g,function(a){return f.cc-a.cc}))&&o.logger.log("live playlist, switching playlist, load frag with same CC: "+i.sn)}i||(i=g[Math.min(h-1,Math.round(h/2))],o.logger.log("live playlist, switching playlist, unknown, load middle frag : "+i.sn))}return i},c.prototype._findFragment=function(a,b,c,d,e,f,g){var h,i=this.hls.config;if(f>e){var j=e>f-i.maxFragLookUpTolerance?0:i.maxFragLookUpTolerance;h=q.findFragmentByPTS(b,d,e,j)}else h=d[c-1];if(h){var k=h.sn-g.startSN,l=b&&h.level===b.level,m=d[k-1],n=d[k+1];if(b&&h.sn===b.sn)if(l&&!h.backtracked)if(h.sn<g.endSN){var p=b.deltaPTS;p&&p>i.maxBufferHole&&b.dropped&&k?(h=m,o.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(h=n,o.logger.log("SN just loaded, load next one: "+h.sn,h))}else h=null;else h.backtracked&&(n&&n.backtracked?(o.logger.warn("Already backtracked from fragment "+n.sn+", will not backtrack to fragment "+h.sn+". Loading fragment "+n.sn),h=n):(o.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),h.dropped=0,m?(h=m).backtracked=!0:k&&(h=null)))}return h},c.prototype._loadKey=function(a){this.state=s.State.KEY_LOADING,this.hls.trigger(h["default"].KEY_LOADING,{frag:a})},c.prototype._loadFragment=function(b){var c=this.fragmentTracker.getState(b);this.fragCurrent=b,this.startFragRequested=!0,a.isFinite(b.sn)&&!b.bitrateTest&&(this.nextLoadPosition=b.start+b.duration),b.backtracked||c===i.FragmentState.NOT_LOADED||c===i.FragmentState.PARTIAL?(b.autoLevel=this.hls.autoLevelEnabled,b.bitrateTest=this.bitrateTest,this.hls.trigger(h["default"].FRAG_LOADING,{frag:b}),this.demuxer||(this.demuxer=new g["default"](this.hls,"main")),this.state=s.State.FRAG_LOADING):c===i.FragmentState.APPENDING&&this._reduceMaxBufferLength(b.duration)&&this.fragmentTracker.removeFragment(b)},Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(a){if(this.state!==a){var b=this.state;this._state=a,o.logger.log("main stream:"+b+"->"+a),this.hls.trigger(h["default"].STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},enumerable:!0,configurable:!0}),c.prototype.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,k["default"].LevelType.MAIN)},Object.defineProperty(c.prototype,"currentLevel",{get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"nextBufferedFrag",{get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null},enumerable:!0,configurable:!0}),c.prototype.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.endPTS+.5):null},Object.defineProperty(c.prototype,"nextLevel",{get:function(){var a=this.nextBufferedFrag;return a?a.level:-1},enumerable:!0,configurable:!0}),c.prototype._checkFragmentChanged=function(){var a,b,c=this.media;if(c&&c.readyState&&!1===c.seeking&&((b=c.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=b),f.BufferHelper.isBuffered(c,b)?a=this.getBufferedFrag(b):f.BufferHelper.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(h["default"].FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(h["default"].LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}},c.prototype.immediateLevelSwitch=function(){if(o.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var b=this.media,c=void 0;b?(c=b.paused,b.pause()):c=!0,this.previouslyPaused=c}var d=this.fragCurrent;d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,a.POSITIVE_INFINITY)},c.prototype.immediateLevelSwitchEnd=function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,f.BufferHelper.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())},c.prototype.nextLevelSwitch=function(){var b=this.media;if(b&&b.readyState){var c,d=void 0,e=void 0;if((c=this.getBufferedFrag(b.currentTime))&&c.startPTS>1&&this.flushMainBuffer(0,c.startPTS-1),b.paused)d=0;else{var f=this.hls.nextLoadLevel,g=this.levels[f],h=this.fragLastKbps;d=h&&this.fragCurrent?this.fragCurrent.duration*g.bitrate/(1e3*h)+1:0}if((e=this.getBufferedFrag(b.currentTime+d))&&(e=this.followingBufferedFrag(e))){var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(e.maxStartPTS,a.POSITIVE_INFINITY)}}},c.prototype.flushMainBuffer=function(a,b){this.state=s.State.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(h["default"].BUFFER_FLUSHING,c)},c.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition),this.gapController=new r["default"](c,b,this.fragmentTracker,this.hls)},c.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(o.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},c.prototype.onMediaSeeked=function(){var b=this.media,c=b?b.currentTime:void 0;a.isFinite(c)&&o.logger.log("media seeked to "+c.toFixed(3)),this.tick()},c.prototype.onManifestLoading=function(){o.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h["default"].BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},c.prototype.onManifestParsed=function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){(b=a.audioCodec)&&(-1!==b.indexOf("mp4a.40.2")&&(c=!0),-1!==b.indexOf("mp4a.40.5")&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&o.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},c.prototype.onLevelLoaded=function(b){var c=b.details,d=b.level,e=this.levels[this.levelLastLoaded],f=this.levels[d],g=c.totalduration,i=0;if(o.logger.log("level "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+g),c.live){var j=f.details;j&&c.fragments.length>0?(l.mergeDetails(j,c),i=c.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(i,j),c.PTSKnown&&a.isFinite(i)?o.logger.log("live playlist sliding:"+i.toFixed(3)):(o.logger.log("live playlist - outdated PTS, unknown sliding"),p.alignStream(this.fragPrevious,e,c))):(o.logger.log("live playlist - first load, unknown sliding"),c.PTSKnown=!1,p.alignStream(this.fragPrevious,e,c))}else c.PTSKnown=!1;if(f.details=c,this.levelLastLoaded=d,this.hls.trigger(h["default"].LEVEL_UPDATED,{details:c,level:d}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var k=c.startTimeOffset;a.isFinite(k)?(0>k&&(o.logger.log("negative start time offset "+k+", count from end of last fragment"),k=i+g+k),o.logger.log("start time offset found in playlist, adjust startPosition to "+k),this.startPosition=k):c.live?(this.startPosition=this.computeLivePosition(i,c),o.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===s.State.WAITING_LEVEL&&(this.state=s.State.IDLE),this.tick()},c.prototype.onKeyLoaded=function(){this.state===s.State.KEY_LOADING&&(this.state=s.State.IDLE,this.tick())},c.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=this.hls,d=this.levels,e=this.media,f=a.frag;if(this.state===s.State.FRAG_LOADING&&b&&"main"===f.type&&f.level===b.level&&f.sn===b.sn){var i=a.stats,j=d[b.level],k=j.details;if(this.bitrateTest=!1,this.stats=i,o.logger.log("Loaded "+b.sn+" of ["+k.startSN+" ,"+k.endSN+"],level "+b.level),f.bitrateTest&&c.nextLoadLevel)this.state=s.State.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=window.performance.now(),c.trigger(h["default"].FRAG_BUFFERED,{stats:i,frag:b,id:"main"}),this.tick();else if("initSegment"===f.sn)this.state=s.State.IDLE,i.tparsed=i.tbuffered=window.performance.now(),k.initSegment.data=a.payload,c.trigger(h["default"].FRAG_BUFFERED,{stats:i,frag:b,id:"main"}),this.tick();else{o.logger.log("Parsing "+b.sn+" of ["+k.startSN+" ,"+k.endSN+"],level "+b.level+", cc "+b.cc),this.state=s.State.PARSING,this.pendingBuffering=!0,this.appended=!1,f.bitrateTest&&(f.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:f}));var l=!(e&&e.seeking)&&(k.PTSKnown||!k.live),m=k.initSegment?k.initSegment.data:[],n=this._getAudioCodec(j);(this.demuxer=this.demuxer||new g["default"](this.hls,"main")).push(a.payload,m,n,j.videoCodec,b,k.totalduration,l)}}this.fragLoadError=0},c.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===s.State.PARSING){var d=a.tracks,e=void 0,f=void 0;if(d.audio&&this.altAudio&&delete d.audio,f=d.audio){var g=this.levels[this.level].audioCodec,i=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(o.logger.log("swapping playlist audio codec"),g=-1!==g.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==f.metadata.channelCount&&-1===i.indexOf("firefox")&&(g="mp4a.40.5"),-1!==i.indexOf("android")&&"audio/mpeg"!==f.container&&(g="mp4a.40.2",o.logger.log("Android: force audio codec to "+g)),f.levelCodec=g,f.id=a.id}for(e in(f=d.video)&&(f.levelCodec=this.levels[this.level].videoCodec,f.id=a.id),this.hls.trigger(h["default"].BUFFER_CODECS,d),d){f=d[e],o.logger.log("main track:"+e+",container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]");var j=f.initSegment;j&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h["default"].BUFFER_APPENDING,{type:e,data:j,parent:"main",content:"initSegment"}))}this.tick()}},c.prototype.onFragParsingData=function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"main"===b.id&&e.sn===d.sn&&e.level===d.level&&("audio"!==b.type||!this.altAudio)&&this.state===s.State.PARSING){var f=this.levels[this.level],g=d;if(a.isFinite(b.endPTS)||(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),!0===b.hasAudio&&g.addElementaryStream(j["default"].ElementaryStreamTypes.AUDIO),!0===b.hasVideo&&g.addElementaryStream(j["default"].ElementaryStreamTypes.VIDEO),o.logger.log("Parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb+",dropped:"+(b.dropped||0)),"video"===b.type)if(g.dropped=b.dropped,g.dropped)if(g.backtracked)o.logger.warn("Already backtracked on this fragment, appending with the gap",g.sn);else{var i=f.details;if(!i||g.sn!==i.startSN)return o.logger.warn("missing video frame(s), backtracking fragment",g.sn),this.fragmentTracker.removeFragment(g),g.backtracked=!0,this.nextLoadPosition=b.startPTS,this.state=s.State.IDLE,this.fragPrevious=g,void this.tick();o.logger.warn("missing video frame(s) on first frag, appending with gap",g.sn)}else g.backtracked=!1;var k=l.updateFragPTSDTS(f.details,g,b.startPTS,b.endPTS,b.startDTS,b.endDTS),m=this.hls;m.trigger(h["default"].LEVEL_PTS_UPDATED,{details:f.details,level:this.level,drift:k,type:b.type,start:b.startPTS,end:b.endPTS}),[b.data1,b.data2].forEach(function(a){a&&a.length&&c.state===s.State.PARSING&&(c.appended=!0,c.pendingBuffering=!0,m.trigger(h["default"].BUFFER_APPENDING,{type:b.type,data:a,parent:"main",content:"data"}))}),this.tick()}},c.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===s.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=s.State.PARSED,this._checkAppendedParsed())},c.prototype.onAudioTrackSwitching=function(b){var c=!!b.url,d=b.id;if(!c){if(this.mediaBuffer!==this.media){o.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var e=this.fragCurrent;e.loader&&(o.logger.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=s.State.IDLE}var f=this.hls;f.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}),f.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:d}),this.altAudio=!1}},c.prototype.onAudioTrackSwitched=function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;
if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(o.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},c.prototype.onBufferCreated=function(a){var b,c,d=a.tracks,e=!1;for(var f in d){var g=d[f];"main"===g.id?(c=f,b=g,"video"===f&&(this.videoBuffer=d[f].buffer)):e=!0}e&&b?(o.logger.log("alternate track found, use "+c+".buffered to schedule main fragment loading"),this.mediaBuffer=b.buffer):this.mediaBuffer=this.media},c.prototype.onBufferAppended=function(a){if("main"===a.parent){var b=this.state;b!==s.State.PARSING&&b!==s.State.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},c.prototype._checkAppendedParsed=function(){if(!(this.state!==s.State.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;o.logger.log("main buffered : "+m["default"].toString(b.buffered)),this.fragPrevious=a;var c=this.stats;c.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*c.total/(c.tbuffered-c.tfirst)),this.hls.trigger(h["default"].FRAG_BUFFERED,{stats:c,frag:a,id:"main"}),this.state=s.State.IDLE}this.tick()}},c.prototype.onError=function(b){var c=b.frag||this.fragCurrent;if(!c||"main"===c.type){var d=!!this.media&&f.BufferHelper.isBuffered(this.media,this.media.currentTime)&&f.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(b.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:if(!b.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var e=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);o.logger.warn("mediaController: frag loading failed, retry in "+e+" ms"),this.retryDate=window.performance.now()+e,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=s.State.FRAG_LOADING_WAITING_RETRY}else o.logger.error("mediaController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=s.State.ERROR;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==s.State.ERROR&&(b.fatal?(this.state=s.State.ERROR,o.logger.warn("streamController: "+b.details+",switch to "+this.state+" state ...")):b.levelRetry||this.state!==s.State.WAITING_LEVEL||(this.state=s.State.IDLE));break;case n.ErrorDetails.BUFFER_FULL_ERROR:"main"!==b.parent||this.state!==s.State.PARSING&&this.state!==s.State.PARSED||(d?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=s.State.IDLE):(o.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,a.POSITIVE_INFINITY)))}}},c.prototype._reduceMaxBufferLength=function(a){var b=this.config;return b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,o.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0)},c.prototype._checkBuffer=function(){var a=this.media;if(a&&0!==a.readyState){var b=(this.mediaBuffer?this.mediaBuffer:a).buffered;!this.loadedmetadata&&b.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,b)}},c.prototype.onFragLoadEmergencyAborted=function(){this.state=s.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},c.prototype.onBufferFlushed=function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;a&&this.fragmentTracker.detectEvictedFragments(j["default"].ElementaryStreamTypes.VIDEO,a.buffered),this.state=s.State.IDLE,this.fragPrevious=null},c.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},c.prototype.computeLivePosition=function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)},c.prototype._seekToStartPos=function(){var a=this.media,b=a.currentTime,c=a.seeking?b:this.startPosition;b!==c&&(o.logger.log("target start position not buffered, seek to buffered.start(0) "+c+" from current time "+b+" "),a.currentTime=c)},c.prototype._getAudioCodec=function(a){var b=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&(o.logger.log("swapping playlist audio codec"),b&&(b=-1!==b.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),b},Object.defineProperty(c.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a},enumerable:!0,configurable:!0}),c}(s["default"]);b["default"]=t}).call(this,c(2).Number)},function(a,b,c){function d(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/",b.oe=function(a){throw console.error(a),a};var d=b(b.s=ENTRY_MODULE);return d["default"]||d}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){return!isNaN(1*a)}function g(a,b,d){var g={};g[d]=[];var h=b.toString(),k=h.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!k)return g;for(var l,m=k[1],n=new RegExp("(\\\\n|\\W)"+e(m)+j,"g");l=n.exec(h);)"dll-reference"!==l[3]&&g[d].push(l[3]);for(n=new RegExp("\\("+e(m)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+j,"g");l=n.exec(h);)a[l[2]]||(g[d].push(l[1]),a[l[2]]=c(l[1]).m),g[l[2]]=g[l[2]]||[],g[l[2]].push(l[4]);for(var o=Object.keys(g),p=0;p<o.length;p++)for(var q=0;q<g[o[p]].length;q++)f(g[o[p]][q])&&(g[o[p]][q]=1*g[o[p]][q]);return g}function h(a){return Object.keys(a).reduce(function(b,c){return b||a[c].length>0},!1)}var i="[\\.|\\-|\\+|\\w|/|@]+",j="\\((/\\*.*?\\*/)?s?.*?("+i+").*?\\)";a.exports=function(a,b){b=b||{};var e={main:c.m},f=b.all?{main:Object.keys(e.main)}:function(a,b){for(var c={main:[b]},d={main:[]},e={main:{}};h(c);)for(var f=Object.keys(c),i=0;i<f.length;i++){var j=f[i],k=c[j].pop();if(e[j]=e[j]||{},!e[j][k]&&a[j][k]){e[j][k]=!0,d[j]=d[j]||[],d[j].push(k);for(var l=g(a,a[j][k],j),m=Object.keys(l),n=0;n<m.length;n++)c[m[n]]=c[m[n]]||[],c[m[n]]=c[m[n]].concat(l[m[n]])}}return d}(e,a),i="";Object.keys(f).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;f[a][b];)b++;f[a].push(b),e[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+f[a].map(function(b){return JSON.stringify(b)+": "+e[a][b].toString()}).join(",")+"});\n"}),i=i+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.main.map(function(a){return JSON.stringify(a)+": "+e.main[a].toString()}).join(",")+"}))(self);";var j=new window.Blob([i],{type:"text/javascript"});if(b.bare)return j;var k=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(j),l=new window.Worker(k);return l.objectURL=k,l}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.subtle=a,this.aesIV=b}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}();b["default"]=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.subtle=a,this.key=b}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}();b["default"]=d},function(a,b,c){"use strict";function d(a){var b=a.byteLength,c=b&&new DataView(a).getUint8(b-1);return c?a.slice(0,b-c):a}Object.defineProperty(b,"__esModule",{value:!0}),b.removePadding=d;var e=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a.prototype.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;4>d;d++)c[d]=b.getUint32(4*d);return c},a.prototype.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;256>p;p++)m[p]=128>p?p<<1:p<<1^283;for(p=0;256>p;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},a.prototype.expandKey=function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f,g,h,i,j=this.ksRows=4*(e+6+1),k=this.keySchedule=new Uint32Array(j),l=this.invKeySchedule=new Uint32Array(j),m=this.sBox,n=this.rcon,o=this.invSubMix,p=o[0],q=o[1],r=o[2],s=o[3];for(f=0;j>f;f++)e>f?h=k[f]=b[f]:(i=h,f%e==0?(i=m[(i=i<<8|i>>>24)>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i],i^=n[f/e|0]<<24):e>6&&f%e==4&&(i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i]),k[f]=h=(k[f-e]^i)>>>0);for(g=0;j>g;g++)f=j-g,i=3&g?k[f]:k[f-4],l[g]=4>g||4>=f?i:p[m[i>>>24]]^q[m[i>>>16&255]]^r[m[i>>>8&255]]^s[m[255&i]],l[g]=l[g]>>>0}},a.prototype.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},a.prototype.decrypt=function(a,b,c,e){for(var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this.keySize+6,u=this.invKeySchedule,v=this.invSBox,w=this.invSubMix,x=w[0],y=w[1],z=w[2],A=w[3],B=this.uint8ArrayToUint32Array_(c),C=B[0],D=B[1],E=B[2],F=B[3],G=new Int32Array(a),H=new Int32Array(G.length),I=this.networkToHostOrderSwap;b<G.length;){for(n=I(G[b]),o=I(G[b+1]),p=I(G[b+2]),q=I(G[b+3]),j=n^u[0],k=q^u[1],l=p^u[2],m=o^u[3],r=4,s=1;t>s;s++)f=x[j>>>24]^y[k>>16&255]^z[l>>8&255]^A[255&m]^u[r],g=x[k>>>24]^y[l>>16&255]^z[m>>8&255]^A[255&j]^u[r+1],h=x[l>>>24]^y[m>>16&255]^z[j>>8&255]^A[255&k]^u[r+2],i=x[m>>>24]^y[j>>16&255]^z[k>>8&255]^A[255&l]^u[r+3],j=f,k=g,l=h,m=i,r+=4;f=v[j>>>24]<<24^v[k>>16&255]<<16^v[l>>8&255]<<8^v[255&m]^u[r],g=v[k>>>24]<<24^v[l>>16&255]<<16^v[m>>8&255]<<8^v[255&j]^u[r+1],h=v[l>>>24]<<24^v[m>>16&255]<<16^v[j>>8&255]<<8^v[255&k]^u[r+2],i=v[m>>>24]<<24^v[j>>16&255]<<16^v[k>>8&255]<<8^v[255&l]^u[r+3],r+=3,H[b]=I(f^C),H[b+1]=I(i^D),H[b+2]=I(h^E),H[b+3]=I(g^F),C=n,D=o,E=p,F=q,b+=4}return e?d(H.buffer):H.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a}();b["default"]=e},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c(22),e=c(0),f=c(11),g=function(){function b(a,b,c){this.observer=a,this.config=c,this.remuxer=b}return b.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},b.prototype.resetTimeStamp=function(){},b.probe=function(a){if(!a)return!1;for(var b=(f["default"].getID3Data(a,0)||[]).length,c=a.length;c>b;b++)if(d.probe(a,b))return e.logger.log("ADTS sync word found !"),!0;return!1},b.prototype.append=function(b,c,g,h){for(var i=this._audioTrack,j=f["default"].getID3Data(b,0)||[],k=f["default"].getTimeStamp(j),l=a.isFinite(k)?90*k:9e4*c,m=0,n=l,o=b.length,p=j.length,q=[{pts:n,dts:n,data:j}];o-1>p;)if(d.isHeader(b,p)&&o>p+5){d.initTrackConfig(i,this.observer,b,p,i.manifestCodec);var r=d.appendFrame(i,b,p,l,m);if(!r){e.logger.log("Unable to parse AAC frame");break}p+=r.length,n=r.sample.pts,m++}else f["default"].isHeader(b,p)?(j=f["default"].getID3Data(b,p),q.push({pts:n,dts:n,data:j}),p+=j.length):p++;this.remuxer.remux(i,{samples:[]},{samples:q,inputTimeScale:9e4},{samples:[]},c,g,h)},b.prototype.destroy=function(){},b}();b["default"]=g}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(22),e=c(23),f=c(1),g=c(44),h=c(45),i=c(0),j=c(3),k={video:1,audio:2,id3:3,text:4},l=function(){function a(a,b,c,d){this.observer=a,this.config=c,this.typeSupported=d,this.remuxer=b,this.sampleAes=null}return a.prototype.setDecryptData=function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new h["default"](this.observer,this.config,a,this.discardEPB):this.sampleAes=null},a.probe=function(b){var c=a._syncOffset(b);return!(0>c||(c&&i.logger.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),0))},a._syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;b>c;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:k[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===a?0:void 0,isAAC:"audio"===a||void 0,duration:"audio"===a?b:void 0}},a.prototype.resetInitSegment=function(b,c,d,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",e),this._audioTrack=a.createTrack("audio",e),this._id3Track=a.createTrack("id3",e),this._txtTrack=a.createTrack("text",e),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=e},a.prototype.resetTimeStamp=function(){},a.prototype.append=function(b,c,d,e){var g,h,k,l,m,n=b.length,o=!1;this.contiguous=d;var p=this.pmtParsed,q=this._avcTrack,r=this._audioTrack,s=this._id3Track,t=q.pid,u=r.pid,v=s.pid,w=this._pmtId,x=q.pesData,y=r.pesData,z=s.pesData,A=this._parsePAT,B=this._parsePMT,C=this._parsePES,D=this._parseAVCPES.bind(this),E=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this),H=a._syncOffset(b);for(n-=(n+H)%188,g=H;n>g;g+=188)if(71===b[g]){if(h=!!(64&b[g+1]),k=((31&b[g+1])<<8)+b[g+2],(48&b[g+3])>>4>1){if((l=g+5+b[g+4])===g+188)continue}else l=g+4;switch(k){case t:h&&(x&&(m=C(x))&&void 0!==m.pts&&D(m,!1),x={data:[],size:0}),x&&(x.data.push(b.subarray(l,g+188)),x.size+=g+188-l);break;case u:h&&(y&&(m=C(y))&&void 0!==m.pts&&(r.isAAC?E(m):F(m)),y={data:[],size:0}),y&&(y.data.push(b.subarray(l,g+188)),y.size+=g+188-l);break;case v:h&&(z&&(m=C(z))&&void 0!==m.pts&&G(m),z={data:[],size:0}),z&&(z.data.push(b.subarray(l,g+188)),z.size+=g+188-l);break;case 0:h&&(l+=b[l]+1),w=this._pmtId=A(b,l);break;case w:h&&(l+=b[l]+1);var I=B(b,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(t=I.avc)>0&&(q.pid=t),(u=I.audio)>0&&(r.pid=u,r.isAAC=I.isAAC),(v=I.id3)>0&&(s.pid=v),o&&!p&&(i.logger.log("reparse from beginning"),o=!1,g=H-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:o=!0}}else this.observer.trigger(f["default"].ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});x&&(m=C(x))&&void 0!==m.pts?(D(m,!0),q.pesData=null):q.pesData=x,y&&(m=C(y))&&void 0!==m.pts?(r.isAAC?E(m):F(m),r.pesData=null):(y&&y.size&&i.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=y),z&&(m=C(z))&&void 0!==m.pts?(G(m),s.pesData=null):s.pesData=z,null==this.sampleAes?this.remuxer.remux(r,q,s,this._txtTrack,c,d,e):this.decryptAndRemux(r,q,s,this._txtTrack,c,d,e)},a.prototype.decryptAndRemux=function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)},a.prototype.decryptAndRemuxAvc=function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)},a.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},a.prototype._parsePAT=function(a,b){return(31&a[b+10])<<8|a[b+11]},a.prototype._parsePMT=function(a,b,c,d){var e,f,g={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=b+3+((15&a[b+1])<<8|a[b+2])-4,b+=12+((15&a[b+10])<<8|a[b+11]);e>b;){switch(f=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){i.logger.log("unkown stream type:"+a[b]);break}case 15:-1===g.audio&&(g.audio=f);break;case 21:-1===g.id3&&(g.id3=f);break;case 219:if(!d){i.logger.log("unkown stream type:"+a[b]);break}case 27:-1===g.avc&&(g.avc=f);break;case 3:case 4:c?-1===g.audio&&(g.audio=f,g.isAAC=!1):i.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:i.logger.warn("HEVC stream type found, not supported for now");break;default:i.logger.log("unkown stream type:"+a[b])}b+=5+((15&a[b+3])<<8|a[b+4])}return g},a.prototype._parsePES=function(a){var b,c,d,e,f,g,h,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(1===((b=l[0])[0]<<16)+(b[1]<<8)+b[2]){if((d=(b[4]<<8)+b[5])&&d>a.size-6)return null;192&(c=b[7])&&((g=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2)>4294967295&&(g-=8589934592),64&c?((h=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2)>4294967295&&(h-=8589934592),g-h>54e5&&(i.logger.warn(Math.round((g-h)/9e4)+"s delta between PTS and DTS, align them"),g=h)):h=g),j=(e=b[8])+9,a.size-=j,f=new Uint8Array(a.size);for(var n=0,o=l.length;o>n;n++){var p=(b=l[n]).byteLength;if(j){if(j>p){j-=p;continue}b=b.subarray(j),p-=j,j=0}f.set(b,k),k+=p}return d&&(d-=e+3),{data:f,pts:g,dts:h,len:d}}return null},a.prototype.pushAccesUnit=function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||!0===a.key||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&i.logger.log(a.pts+"/"+a.dts+":"+a.debug)},a.prototype._parseAVCPES=function(a,b){var c,d,e,f=this,h=this._avcTrack,i=this._parseAVCNALu(a.data),j=this.avcSample,k=!1,l=this.pushAccesUnit.bind(this),m=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null,j&&i.length&&!h.audFound&&(l(j,h),j=this.avcSample=m(!1,a.pts,a.dts,"")),i.forEach(function(b){switch(b.type){case 1:d=!0,j||(j=f.avcSample=m(!0,a.pts,a.dts,"")),j.frame=!0;var i=b.data;if(k&&i.length>4){var n=new g["default"](i).readSliceType();2!==n&&4!==n&&7!==n&&9!==n||(j.key=!0)}break;case 5:d=!0,j||(j=f.avcSample=m(!0,a.pts,a.dts,"")),j.key=!0,j.frame=!0;break;case 6:d=!0,(c=new g["default"](f.discardEPB(b.data))).readUByte();for(var o=0,p=0,q=!1,r=0;!q&&c.bytesAvailable>1;){o=0;do o+=r=c.readUByte();while(255===r);p=0;do p+=r=c.readUByte();while(255===r);if(4===o&&0!==c.bytesAvailable){if(q=!0,181===c.readUByte()&&49===c.readUShort()&&1195456820===c.readUInt()&&3===c.readUByte()){var s=c.readUByte(),t=31&s,u=[s,c.readUByte()];for(e=0;t>e;e++)u.push(c.readUByte()),u.push(c.readUByte()),u.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:u})}}else if(p<c.bytesAvailable)for(e=0;p>e;e++)c.readUByte()}break;case 7:if(d=!0,k=!0,!h.sps){var v=(c=new g["default"](b.data)).readSPS();h.width=v.width,h.height=v.height,h.pixelRatio=v.pixelRatio,h.sps=[b.data],h.duration=f._duration;var w=b.data.subarray(1,4),x="avc1.";for(e=0;3>e;e++){var y=w[e].toString(16);y.length<2&&(y="0"+y),x+=y}h.codec=x}break;case 8:d=!0,h.pps||(h.pps=[b.data]);break;case 9:d=!1,h.audFound=!0,j&&l(j,h),j=f.avcSample=m(!1,a.pts,a.dts,"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}j&&d&&j.units.push(b)}),b&&j&&(l(j,h),this.avcSample=null)},a.prototype._insertSampleInOrder=function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)},a.prototype._getLastNalUnit=function(){var a,b=this.avcSample;if(!b||0===b.units.length){var c=this._avcTrack.samples;b=c[c.length-1]}if(b){var d=b.units;a=d[d.length-1]}return a},a.prototype._parseAVCNALu=function(a){var b,c,d,e,f=0,g=a.byteLength,h=this._avcTrack,i=h.naluState||0,j=i,k=[],l=-1;for(-1===i&&(l=0,e=31&a[0],i=0,f=1);g>f;)if(b=a[f++],i)if(1!==i)if(b)if(1===b){var m,n;l>=0?(d={data:a.subarray(l,f-i-1),type:e},k.push(d)):(m=this._getLastNalUnit())&&(j&&4-j>=f&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-j)),(c=f-i-1)>0&&((n=new Uint8Array(m.data.byteLength+c)).set(m.data,0),n.set(a.subarray(0,c),m.data.byteLength),m.data=n)),g>f?(l=f,e=31&a[f],i=0):i=-1}else i=0;else i=3;else i=b?0:2;else i=b?0:1;return l>=0&&i>=0&&(d={data:a.subarray(l,g),type:e,state:i},k.push(d)),0===k.length&&(m=this._getLastNalUnit())&&((n=new Uint8Array(m.data.byteLength+a.byteLength)).set(m.data,0),n.set(a,m.data.byteLength),m.data=n),h.naluState=i,k},a.prototype.discardEPB=function(a){for(var b,c,d=a.byteLength,e=[],f=1;d-2>f;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;b>f;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c},a.prototype._parseAACPES=function(a){var b,c,e,g,h,k=this._audioTrack,l=a.data,m=a.pts,n=this.aacOverFlow,o=this.aacLastPTS;if(n){var p=new Uint8Array(n.byteLength+l.byteLength);p.set(n,0),p.set(l,n.byteLength),l=p}for(e=0,h=l.length;h-1>e&&!d.isHeader(l,e);e++);if(e){var q=void 0,r=void 0;if(h-1>e?(q="AAC PES did not start with ADTS header,offset:"+e,r=!1):(q="no ADTS header found in AAC PES",r=!0),i.logger.warn("parsing error:"+q),this.observer.trigger(f["default"].ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_PARSING_ERROR,fatal:r,reason:q}),r)return}if(d.initTrackConfig(k,this.observer,l,e,this.audioCodec),c=0,b=d.getFrameDuration(k.samplerate),n&&o){var s=o+b;Math.abs(s-m)>1&&(i.logger.log("AAC: align PTS for overlapping frames by "+Math.round((s-m)/90)),m=s)}for(;h>e;)if(d.isHeader(l,e)&&h>e+5){var t=d.appendFrame(k,l,e,m,c);if(!t)break;e+=t.length,g=t.sample.pts,c++}else e++;n=h>e?l.subarray(e,h):null,this.aacOverFlow=n,this.aacLastPTS=g},a.prototype._parseMPEGPES=function(a){for(var b=a.data,c=b.length,d=0,f=0,g=a.pts;c>f;)if(e["default"].isHeader(b,f)){var h=e["default"].appendFrame(this._audioTrack,b,f,g,d);if(!h)break;f+=h.length,d++}else f++},a.prototype._parseID3PES=function(a){this._id3Track.samples.push(a)},a}();b["default"]=l},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(0),e=function(){function a(a){this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}return a.prototype.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},a.prototype.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,a-=(b=a>>3)>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},a.prototype.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&d.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),(b=a-b)>0&&this.bitsAvailable?c<<b|this.readBits(b):c},a.prototype.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!=(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},a.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},a.prototype.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},a.prototype.readBoolean=function(){return 1===this.readBits(1)},a.prototype.readUByte=function(){return this.readBits(8)},a.prototype.readUShort=function(){return this.readBits(16)},a.prototype.readUInt=function(){return this.readBits(32)},a.prototype.skipScalingList=function(a){var b,c=8,d=8;for(b=0;a>b;b++)0!==d&&(d=(c+this.readEG()+256)%256),c=0===d?c:d},a.prototype.readSPS=function(){var a,b,c,d,e,f,g,h=0,i=0,j=0,k=0,l=this.readUByte.bind(this),m=this.readBits.bind(this),n=this.readUEG.bind(this),o=this.readBoolean.bind(this),p=this.skipBits.bind(this),q=this.skipEG.bind(this),r=this.skipUEG.bind(this),s=this.skipScalingList.bind(this);if(l(),a=l(),m(5),p(3),l(),r(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var t=n();if(3===t&&p(1),r(),r(),p(1),o())for(f=3!==t?8:12,g=0;f>g;g++)o()&&s(6>g?16:64)}r();var u=n();if(0===u)n();else if(1===u)for(p(1),q(),q(),b=n(),g=0;b>g;g++)q();r(),p(1),c=n(),d=n(),0===(e=m(1))&&p(1),p(1),o()&&(h=n(),i=n(),j=n(),k=n());var v=[1,1];if(o()&&o())switch(l()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(c+1)-2*h-2*i),height:(2-e)*(d+1)*16-(e?2:4)*(j+k),pixelRatio:v}},a.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}();b["default"]=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(13),e=function(){function a(a,b,c,e){this.decryptdata=c,this.discardEPB=e,this.decrypter=new d["default"](a,b,{removePKCS7Padding:!1})}return a.prototype.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)},a.prototype.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})},a.prototype.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},a.prototype.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},a.prototype.getAvcDecryptedUnit=function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a},a.prototype.decryptAvcSample=function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})},a.prototype.decryptAvcSamples=function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}();b["default"]=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(11),e=c(0),f=c(23),g=function(){function a(a,b,c){this.observer=a,this.config=c,this.remuxer=b}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){var b,c,g=d["default"].getID3Data(a,0);if(g&&void 0!==d["default"].getTimeStamp(g))for(b=g.length,c=Math.min(a.length-1,b+100);c>b;b++)if(f["default"].probe(a,b))return e.logger.log("MPEG Audio sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,e){for(var g=d["default"].getID3Data(a,0),h=d["default"].getTimeStamp(g),i=h?90*h:9e4*b,j=g.length,k=a.length,l=0,m=0,n=this._audioTrack,o=[{pts:i,dts:i,data:g}];k>j;)if(f["default"].isHeader(a,j)){var p=f["default"].appendFrame(n,a,j,i,l);if(!p)break;j+=p.length,m=p.sample.pts,l++}else d["default"].isHeader(a,j)?(g=d["default"].getID3Data(a,j),o.push({pts:m,dts:m,data:g}),j+=g.length):j++;this.remuxer.remux(n,{samples:[]},{samples:o,inputTimeScale:9e4},{samples:[]},b,c,e)},a.prototype.destroy=function(){},a}();b["default"]=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(48),e=c(49),f=c(1),g=c(3),h=c(0),i=function(){function a(a,b,c,d){this.observer=a,this.config=b,this.typeSupported=c;var e=navigator.userAgent;this.isSafari=d&&d.indexOf("Apple")>-1&&e&&!e.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(a){this._initPTS=this._initDTS=a},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.remux=function(a,b,c,d,e,g,i){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated){var j=a.samples.length,k=b.samples.length,l=e,m=e;if(j&&k){var n=(a.samples[0].pts-b.samples[0].pts)/b.inputTimeScale;l+=Math.max(0,n),m+=Math.max(0,-n)}if(j){a.timescale||(h.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var o=this.remuxAudio(a,l,g,i);if(k){var p=void 0;o&&(p=o.endPTS-o.startPTS),b.timescale||(h.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,m,g,p,i)}}else if(k){var q=this.remuxVideo(b,m,g,0,i);q&&a.codec&&this.remuxEmptyAudio(a,l,g,q)}}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(f["default"].FRAG_PARSED)},a.prototype.generateIS=function(a,b,c){var d,i,j=this.observer,k=a.samples,l=b.samples,m=this.typeSupported,n="audio/mp4",o={},p={tracks:o},q=void 0===this._initPTS;if(q&&(d=i=1/0),a.config&&k.length&&(a.timescale=a.samplerate,h.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(m.mpeg?(n="audio/mpeg",a.codec=""):m.mp3&&(a.codec="mp3")),o.audio={container:n,codec:a.codec,initSegment:!a.isAAC&&m.mpeg?new Uint8Array:e["default"].initSegment([a]),metadata:{channelCount:a.channelCount}},q&&(d=i=k[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&l.length){var r=b.inputTimeScale;b.timescale=r,o.video={container:"video/mp4",codec:b.codec,initSegment:e["default"].initSegment([b]),metadata:{width:b.width,height:b.height}},q&&(d=Math.min(d,l[0].pts-r*c),i=Math.min(i,l[0].dts-r*c),this.observer.trigger(f["default"].INIT_PTS_FOUND,{initPTS:d}))}Object.keys(o).length?(j.trigger(f["default"].FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,q&&(this._initPTS=d,this._initDTS=i)):j.trigger(f["default"].ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(a,b,c,d,i){var j,k,l,m,n,o,p,q=8,r=a.timescale,s=a.samples,t=[],u=s.length,v=this._PTSNormalize,w=this._initPTS,x=this.nextAvcDts,y=this.isSafari;if(0!==u){y&&(c|=s.length&&x&&(i&&Math.abs(b-x/r)<.1||Math.abs(s[0].pts-x-w)<r/5)),c||(x=b*r),s.forEach(function(a){a.pts=v(a.pts-w,x),a.dts=v(a.dts-w,x)}),s.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||d||a.id-b.id});var z=s.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(0>z){h.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(z/90)+" ms to overcome this issue");
for(var A=0;A<s.length;A++)s[A].dts+=z}var B=s[0];n=Math.max(B.dts,0),m=Math.max(B.pts,0);var C=Math.round((n-x)/90);c&&C&&(C>1?h.logger.log("AVC:"+C+" ms hole between fragments detected,filling it"):-1>C&&h.logger.log("AVC:"+-C+" ms overlapping between fragments detected"),n=x,s[0].dts=n,m=Math.max(m-C,x),s[0].pts=m,h.logger.log("Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(n/90)+",delta:"+C+" ms")),B=s[s.length-1],p=Math.max(B.dts,0),o=Math.max(B.pts,0,p),y&&(j=Math.round((p-n)/(s.length-1)));var D=0,E=0;for(A=0;u>A;A++){for(var F=s[A],G=F.units,H=G.length,I=0,J=0;H>J;J++)I+=G[J].data.length;E+=I,D+=H,F.length=I,F.dts=y?n+A*j:Math.max(F.dts,n),F.pts=Math.max(F.pts,F.dts)}var K=E+4*D+8;try{k=new Uint8Array(K)}catch(a){return void this.observer.trigger(f["default"].ERROR,{type:g.ErrorTypes.MUX_ERROR,details:g.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:K,reason:"fail allocating video mdat "+K})}var L=new DataView(k.buffer);for(L.setUint32(0,K),k.set(e["default"].types.mdat,4),A=0;u>A;A++){var M=s[A],N=M.units,O=0,P=void 0;for(J=0,H=N.length;H>J;J++){var Q=N[J],R=Q.data,S=Q.data.byteLength;L.setUint32(q,S),q+=4,k.set(R,q),q+=S,O+=4+S}if(y)P=Math.max(0,j*Math.round((M.pts-M.dts)/j));else{if(u-1>A)j=s[A+1].dts-M.dts;else{var T=this.config,U=M.dts-s[A>0?A-1:A].dts;if(T.stretchShortVideoTrack){var V=T.maxBufferHole,W=Math.floor(V*r),X=(d?m+d*r:this.nextAudioPts)-M.pts;X>W?((j=X-U)<0&&(j=U),h.logger.log("It is approximately "+X/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=U}else j=U}P=Math.round(M.pts-M.dts)}t.push({size:O,duration:j,cts:P,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:M.key?2:1,isNonSync:M.key?0:1}})}this.nextAvcDts=p+j;var Y=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,t.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Z=t[0].flags;Z.dependsOn=2,Z.isNonSync=0}a.samples=t,l=e["default"].moof(a.sequenceNumber++,n,a),a.samples=[];var $={data1:l,data2:k,startPTS:m/r,endPTS:(o+j)/r,startDTS:n/r,endDTS:this.nextAvcDts/r,type:"video",hasAudio:!1,hasVideo:!0,nb:t.length,dropped:Y};return this.observer.trigger(f["default"].FRAG_PARSING_DATA,$),$}},a.prototype.remuxAudio=function(a,b,c,i){var j,k,l,m,n,o,p,q=a.inputTimeScale,r=a.timescale,s=q/r,t=(a.isAAC?1024:1152)*s,u=this._PTSNormalize,v=this._initPTS,w=!a.isAAC&&this.typeSupported.mpeg,x=a.samples,y=[],z=this.nextAudioPts;if(c|=x.length&&z&&(i&&Math.abs(b-z/q)<.1||Math.abs(x[0].pts-z-v)<20*t),x.forEach(function(a){a.pts=a.dts=u(a.pts-v,b*q)}),0!==(x=x.filter(function(a){return a.pts>=0})).length){if(c||(z=i?b*q:x[0].pts),a.isAAC)for(var A=this.config.maxAudioFramesDrift,B=0,C=z;B<x.length;){var D,E=x[B];D=(M=E.pts)-C;var F=Math.abs(1e3*D/q);if(-A*t>=D)h.logger.warn("Dropping 1 audio frame @ "+(C/q).toFixed(3)+"s due to "+Math.round(F)+" ms overlap."),x.splice(B,1),a.len-=E.unit.length;else if(D>=A*t&&1e4>F&&C){var G=Math.round(D/t);h.logger.warn("Injecting "+G+" audio frame @ "+(C/q).toFixed(3)+"s due to "+Math.round(1e3*D/q)+" ms gap.");for(var H=0;G>H;H++){var I=Math.max(C,0);(l=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||(h.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),l=E.unit.subarray()),x.splice(B,0,{unit:l,pts:I,dts:I}),a.len+=l.length,C+=t,B++}E.pts=E.dts=C,C+=t,B++}else Math.abs(D),E.pts=E.dts=C,C+=t,B++}H=0;for(var J=x.length;J>H;H++){var K=x[H],L=K.unit,M=K.pts;if(void 0!==p)k.duration=Math.round((M-p)/s);else{var N=Math.round(1e3*(M-z)/q),O=0;if(c&&a.isAAC&&N){if(N>0&&1e4>N)O=Math.round((M-z)/t),h.logger.log(N+" ms hole between AAC samples detected,filling it"),O>0&&((l=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||(l=L.subarray()),a.len+=O*l.length);else if(-12>N){h.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(z/q).toFixed(3)+"s/"+(M/q).toFixed(3)+"s/"+-N+"ms"),a.len-=L.byteLength;continue}M=z}if(o=M,!(a.len>0))return;var P=w?a.len:a.len+8;j=w?0:8;try{m=new Uint8Array(P)}catch(a){return void this.observer.trigger(f["default"].ERROR,{type:g.ErrorTypes.MUX_ERROR,details:g.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:P,reason:"fail allocating audio mdat "+P})}for(w||(new DataView(m.buffer).setUint32(0,P),m.set(e["default"].types.mdat,4)),B=0;O>B;B++)(l=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount))||(h.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),l=L.subarray()),m.set(l,j),j+=l.byteLength,k={size:l.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(k)}m.set(L,j);var Q=L.byteLength;j+=Q,k={size:Q,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(k),p=M}var R=0,S=y.length;if(S>=2&&(R=y[S-2].duration,k.duration=R),S){this.nextAudioPts=z=p+s*R,a.len=0,a.samples=y,n=w?new Uint8Array:e["default"].moof(a.sequenceNumber++,o/s,a),a.samples=[];var T=o/q,U=z/q,V={data1:n,data2:m,startPTS:T,endPTS:U,startDTS:T,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.observer.trigger(f["default"].FRAG_PARSING_DATA,V),V}return null}},a.prototype.remuxEmptyAudio=function(a,b,c,e){var f=a.inputTimeScale,g=f/(a.samplerate?a.samplerate:f),i=this.nextAudioPts,j=(void 0!==i?i:e.startDTS*f)+this._initDTS,k=e.endDTS*f+this._initDTS,l=1024*g,m=Math.ceil((k-j)/l),n=d["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(h.logger.warn("remux empty Audio"),n){for(var o=[],p=0;m>p;p++){var q=j+p*l;o.push({unit:n,pts:q,dts:q}),a.len+=n.length}a.samples=o,this.remuxAudio(a,b,c)}else h.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},a.prototype.remuxID3=function(a){var b,c=a.samples.length,d=a.inputTimeScale,e=this._initPTS,g=this._initDTS;if(c){for(var h=0;c>h;h++)(b=a.samples[h]).pts=(b.pts-e)/d,b.dts=(b.dts-g)/d;this.observer.trigger(f["default"].FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[]},a.prototype.remuxText=function(a){a.samples.sort(function(a,b){return a.pts-b.pts});var b,c=a.samples.length,d=a.inputTimeScale,e=this._initPTS;if(c){for(var g=0;c>g;g++)(b=a.samples[g]).pts=(b.pts-e)/d;this.observer.trigger(f["default"].FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[]},a.prototype._PTSNormalize=function(a,b){var c;if(void 0===b)return a;for(c=a>b?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a},a}();b["default"]=i},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.getSilentFrame=function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a}();b["default"]=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=Math.pow(2,32)-1,e=function(){function a(){}return a.init=function(){var b;for(b in a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for((b=new Uint8Array(d))[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;f>e;e++)b.set(c[e],d),d+=c[e].byteLength;return b},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,g)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)e=(d=b.sps[c]).byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)e=(d=b.pps[c]).byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,e=b.duration*b.timescale,f=b.width,g=b.height,h=Math.floor(e/(d+1)),i=Math.floor(e%(d+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,f>>8&255,255&f,0,0,g>>8&255,255&g,0,0]))},a.traf=function(b,c){var e=a.sdtp(b),f=b.id,g=Math.floor(c/(d+1)),h=Math.floor(c%(d+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,255&f])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h])),a.trun(b,e.length+16+20+8+16+8+8),e)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;k>d;d++)f=(e=j[d]).duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c,d=a.moov(b);return(c=new Uint8Array(a.FTYP.byteLength+d.byteLength)).set(a.FTYP),c.set(d,a.FTYP.byteLength),c},a}();b["default"]=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(1),e=function(){function a(a){this.observer=a}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(){},a.prototype.resetInitSegment=function(){},a.prototype.remux=function(a,b,c,e,f,g,h,i){var j=this.observer,k="";a&&(k+="audio"),b&&(k+="video"),j.trigger(d["default"].FRAG_PARSING_DATA,{data1:i,startPTS:f,startDTS:f,type:k,hasAudio:!!a,hasVideo:!!b,nb:1,dropped:0}),j.trigger(d["default"].FRAG_PARSED)},a}();b["default"]=e},function(a,b,c){"use strict";function d(){}function e(a,b,c,d,e){if("function"!=typeof c)throw new TypeError("The listener must be a function");var f=new function(a,b,c){this.fn=a,this.context=b,this.once=c||!1}(c,d||a,e),g=i?i+b:b;return a._events[g]?a._events[g].fn?a._events[g]=[a._events[g],f]:a._events[g].push(f):(a._events[g]=f,a._eventsCount++),a}function f(a,b){0==--a._eventsCount?a._events=new d:delete a._events[b]}function g(){this._events=new d,this._eventsCount=0}var h=Object.prototype.hasOwnProperty,i="~";Object.create&&(d.prototype=Object.create(null),(new d).__proto__||(i=!1)),g.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)h.call(a,b)&&c.push(i?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},g.prototype.listeners=function(a){var b=i?i+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=new Array(e);e>d;d++)f[d]=c[d].fn;return f},g.prototype.listenerCount=function(a){var b=i?i+a:a,c=this._events[b];return c?c.fn?1:c.length:0},g.prototype.emit=function(a,b,c,d,e,f){var g=i?i+a:a;if(!this._events[g])return!1;var h,j,k=this._events[g],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,f),!0}for(j=1,h=new Array(l-1);l>j;j++)h[j-1]=arguments[j];k.fn.apply(k.context,h)}else{var m,n=k.length;for(j=0;n>j;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!h)for(m=1,h=new Array(l-1);l>m;m++)h[m-1]=arguments[m];k[j].fn.apply(k[j].context,h)}}return!0},g.prototype.on=function(a,b,c){return e(this,a,b,c,!1)},g.prototype.once=function(a,b,c){return e(this,a,b,c,!0)},g.prototype.removeListener=function(a,b,c,d){var e=i?i+a:a;if(!this._events[e])return this;if(!b)return f(this,e),this;var g=this._events[e];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||f(this,e);else{for(var h=0,j=[],k=g.length;k>h;h++)(g[h].fn!==b||d&&!g[h].once||c&&g[h].context!==c)&&j.push(g[h]);j.length?this._events[e]=1===j.length?j[0]:j:f(this,e)}return this},g.prototype.removeAllListeners=function(a){var b;return a?(b=i?i+a:a,this._events[b]&&f(this,b)):(this._events=new d,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=i,g.EventEmitter=g,a.exports=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(21),e=c(1),f=c(0),g=c(53);b["default"]=function(a){var b=new g.EventEmitter;b.trigger=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];b.emit.apply(b,[a,a].concat(c))},b.off=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];b.removeListener.apply(b,[a].concat(c))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(e){var g=e.data;switch(g.cmd){case"init":var h=JSON.parse(g.config);a.demuxer=new d["default"](b,g.typeSupported,h,g.vendor),f.enableLogs(h.debug),c("init",null);break;case"demux":a.demuxer.push(g.data,g.decryptdata,g.initSegment,g.audioCodec,g.videoCodec,g.timeOffset,g.discontinuity,g.trackSwitch,g.contiguous,g.duration,g.accurateTimeOffset,g.defaultInitPTS)}}),b.on(e["default"].FRAG_DECRYPTED,c),b.on(e["default"].FRAG_PARSING_INIT_SEGMENT,c),b.on(e["default"].FRAG_PARSED,c),b.on(e["default"].ERROR,c),b.on(e["default"].FRAG_PARSING_METADATA,c),b.on(e["default"].FRAG_PARSING_USERDATA,c),b.on(e["default"].INIT_PTS_FOUND,c),b.on(e["default"].FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})}},function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"object"==typeof a&&null!==a}function f(a){return void 0===a}a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!function(a){return"number"==typeof a}(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,g,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||e(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(f(c=this._events[a]))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(e(c))for(h=Array.prototype.slice.call(arguments,1),g=(j=c.slice()).length,i=0;g>i;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var g;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?e(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,e(this._events[a])&&!this._events[a].warned&&(g=f(this._maxListeners)?c.defaultMaxListeners:this._maxListeners)&&g>0&&this._events[a].length>g&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,f,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(g=(c=this._events[a]).length,f=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(e(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){f=h;break}if(0>f)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(f,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(d(c=this._events[a]))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){return this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(5),e=c(3),f=c(1),g=c(0),h=function(){function a(a,b,c,d){this.config=a,this.media=b,this.fragmentTracker=c,this.hls=d,this.stallReported=!1}return a.prototype.poll=function(a,b){var c=this.config,e=this.media,f=e.currentTime,h=window.performance.now();if(f!==a)return this.stallReported&&(g.logger.warn("playback not stuck anymore @"+f+", after "+Math.round(h-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(e.ended||!e.buffered.length||e.readyState>2||e.seeking&&d.BufferHelper.isBuffered(e,f))){var i=h-this.stalled,j=d.BufferHelper.bufferInfo(e,f,c.maxBufferHole);this.stalled?(i>=1e3&&this._reportStall(j.len),this._tryFixBufferStall(j,i)):this.stalled=h}},a.prototype._tryFixBufferStall=function(a,b){var c=this.config,d=this.fragmentTracker,e=this.media.currentTime,f=d.getPartialFragment(e);f&&this._trySkipBufferHole(f),a.len>.5&&b>1e3*c.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},a.prototype._reportStall=function(a){var b=this.hls,c=this.media;this.stallReported||(this.stallReported=!0,g.logger.warn("Playback stalling at @"+c.currentTime+" due to low buffer"),b.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},a.prototype._trySkipBufferHole=function(a){for(var b=this.hls,c=this.media,d=c.currentTime,h=0,i=0;i<c.buffered.length;i++){var j=c.buffered.start(i);if(d>=h&&j>d)return c.currentTime=Math.max(j,c.currentTime+.1),g.logger.warn("skipping hole, adjusting currentTime from "+d+" to "+c.currentTime),this.stalled=null,void b.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+d+" to "+c.currentTime,frag:a});h=c.buffered.end(i)}},a.prototype._tryNudgeBuffer=function(){var a=this.config,b=this.hls,c=this.media,d=c.currentTime,h=(this.nudgeRetry||0)+1;if(this.nudgeRetry=h,h<a.nudgeMaxRetry){var i=d+h*a.nudgeOffset;g.logger.log("adjust currentTime from "+d+" to "+i),c.currentTime=i,b.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else g.logger.error("still stuck in high buffer @"+d+" after "+a.nudgeMaxRetry+", raise fatal error"),b.trigger(f["default"].ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},a}();b["default"]=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(1),g=c(4),h=c(0),i=c(3),j=c(19),k=c(8),l=(window.performance,function(a){function b(b){var c=a.call(this,b,f["default"].MANIFEST_LOADED,f["default"].LEVEL_LOADED,f["default"].AUDIO_TRACK_SWITCHED,f["default"].FRAG_LOADED,f["default"].ERROR)||this;return c.canload=!1,c.currentLevelIndex=null,c.manualLevelIndex=-1,c.timer=null,e=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c}return d(b,a),b.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},b.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.startLoad=function(){var a=this._levels;this.canload=!0,this.levelRetryCount=0,a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),null!==this.timer&&this.loadLevel()},b.prototype.stopLoad=function(){this.canload=!1},b.prototype.onManifestLoaded=function(a){var b,c=[],d=[],g={},l=null,m=!1,n=!1;if(a.levels.forEach(function(a){var b=a.attrs;a.loadError=0,a.fragmentError=!1,m=m||!!a.videoCodec,n=n||!!a.audioCodec,e&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),(l=g[a.bitrate])?l.url.push(a.url):(a.url=[a.url],a.urlId=0,g[a.bitrate]=a,c.push(a)),b&&(b.AUDIO&&(n=!0,k.addGroupId(l||a,"audio",b.AUDIO)),b.SUBTITLES&&k.addGroupId(l||a,"text",b.SUBTITLES))}),m&&n&&(c=c.filter(function(a){return!!a.videoCodec})),c=c.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||j.isCodecSupportedInMp4(b,"audio"))&&(!c||j.isCodecSupportedInMp4(c,"video"))}),a.audioTracks&&(d=a.audioTracks.filter(function(a){return!a.audioCodec||j.isCodecSupportedInMp4(a.audioCodec,"audio")})).forEach(function(a,b){a.id=b}),c.length>0){b=c[0].bitrate,c.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=c;for(var o=0;o<c.length;o++)if(c[o].bitrate===b){this._firstLevel=o,h.logger.log("manifest loaded,"+c.length+" level(s) found, first bitrate:"+b);break}this.hls.trigger(f["default"].MANIFEST_PARSED,{levels:c,audioTracks:d,firstLevel:this._firstLevel,stats:a.stats,audio:n,video:m,altAudio:d.some(function(a){return!!a.url})})}else this.hls.trigger(f["default"].ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(b.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(a){var b=this._levels;b&&(a=Math.min(a,b.length-1),this.currentLevelIndex===a&&b[a].details||this.setLevelInternal(a))},enumerable:!0,configurable:!0}),b.prototype.setLevelInternal=function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.clearTimer(),this.currentLevelIndex!==a){h.logger.log("switching to level "+a),this.currentLevelIndex=a;var d=b[a];d.level=a,c.trigger(f["default"].LEVEL_SWITCHING,d)}var e=b[a],g=e.details;if(!g||g.live){var j=e.urlId;c.trigger(f["default"].LEVEL_LOADING,{url:e.url[j],level:a,id:j})}}else c.trigger(f["default"].ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(b.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(a){this._firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a},enumerable:!0,configurable:!0}),b.prototype.onError=function(a){if(a.fatal)a.type===i.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var b,c=!1,d=!1;switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:b=a.frag.level,d=!0;break;case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:b=a.context.level,c=!0;break;case i.ErrorDetails.REMUX_ALLOC_ERROR:b=a.level,c=!0}void 0!==b&&this.recoverLevel(a,b,c,d)}},b.prototype.recoverLevel=function(a,b,c,d){var e,f,g,i=this,j=this.hls.config,k=a.details,l=this._levels[b];if(l.loadError++,l.fragmentError=d,c){if(!(this.levelRetryCount+1<=j.levelLoadingMaxRetry))return h.logger.error("level controller, cannot recover from "+k+" error"),this.currentLevelIndex=null,this.clearTimer(),void(a.fatal=!0);f=Math.min(Math.pow(2,this.levelRetryCount)*j.levelLoadingRetryDelay,j.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return i.loadLevel()},f),a.levelRetry=!0,this.levelRetryCount++,h.logger.warn("level controller, "+k+", retry in "+f+" ms, current retry count is "+this.levelRetryCount)}(c||d)&&((e=l.url.length)>1&&l.loadError<e?(l.urlId=(l.urlId+1)%e,l.details=void 0,h.logger.warn("level controller, "+k+" for level "+b+": switching to redundant URL-id "+l.urlId)):-1===this.manualLevelIndex?(g=0===b?this._levels.length-1:b-1,h.logger.warn("level controller, "+k+": switch to "+g),this.hls.nextAutoLevel=this.currentLevelIndex=g):d&&(h.logger.warn("level controller, "+k+": reload a fragment"),this.currentLevelIndex=null))},b.prototype.onFragLoaded=function(a){var b=a.frag;if(void 0!==b&&"main"===b.type){var c=this._levels[b.level];void 0!==c&&(c.fragmentError=!1,c.loadError=0,this.levelRetryCount=0)}},b.prototype.onLevelLoaded=function(a){var b=this,c=a.level,d=a.details;if(c===this.currentLevelIndex){var e=this._levels[c];if(e.fragmentError||(e.loadError=0,this.levelRetryCount=0),d.live){var f=k.computeReloadInterval(e.details,d,a.stats.trequest);h.logger.log("live playlist, reload in "+Math.round(f)+" ms"),this.timer=setTimeout(function(){return b.loadLevel()},f)}else this.clearTimer()}},b.prototype.onAudioTrackSwitched=function(a){var b=this.hls.audioTracks[a.id].groupId,c=this.hls.levels[this.currentLevelIndex];
if(c&&c.audioGroupIds){for(var d=-1,e=0;e<c.audioGroupIds.length;e++)if(c.audioGroupIds[e]===b){d=e;break}d!==c.urlId&&(c.urlId=d,this.startLoad())}},b.prototype.loadLevel=function(){if(h.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var a=this._levels[this.currentLevelIndex];if("object"==typeof a&&a.url.length>0){var b=this.currentLevelIndex,c=a.urlId,d=a.url[c];h.logger.log("Attempt loading level index "+b+" with URL-id "+c),this.hls.trigger(f["default"].LEVEL_LOADING,{url:d,level:b,id:c})}}},Object.defineProperty(b.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)},enumerable:!0,configurable:!0}),b}(g["default"]));b["default"]=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(11),h=c(29),i=function(a){function b(b){var c=a.call(this,b,e["default"].MEDIA_ATTACHED,e["default"].MEDIA_DETACHING,e["default"].FRAG_PARSING_METADATA)||this;return c.id3Track=void 0,c.media=void 0,c}return d(b,a),b.prototype.destroy=function(){f["default"].prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){this.media=a.media,this.media},b.prototype.onMediaDetaching=function(){h.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},b.prototype.getID3Track=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("metadata"===c.kind&&"id3"===c.label)return h.sendAddTrackEvent(c,this.media),c}return this.media.addTextTrack("metadata","id3")},b.prototype.onFragParsingMetadata=function(a){var b=a.frag,c=a.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<c.length;e++){var f=g["default"].getID3Frames(c[e].data);if(f){var h=c[e].pts,i=e<c.length-1?c[e+1].pts:b.endPTS;h===i&&(i+=1e-4);for(var j=0;j<f.length;j++){var k=f[j];if(!g["default"].isTimeStampFrame(k)){var l=new d(h,i,"");l.value=k,this.id3Track.addCue(l)}}}}},b}(f["default"]);b["default"]=i},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(14);b.isSupported=function(){var a=d.getMediaSource(),b=window.SourceBuffer||window.WebKitSourceBuffer,c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!e}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(59),e=c(62),f=c(63),g=c(64),h=c(65),i=c(66),j=c(67),k=c(68),l=c(70),m=c(74),n=c(75),o=c(76),p=c(77);b.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:h["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:d["default"],bufferController:e["default"],capLevelController:f["default"],fpsController:g["default"],stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:p.requestMediaKeySystemAccess},b.hlsDefaultConfig.subtitleStreamController=n.SubtitleStreamController,b.hlsDefaultConfig.subtitleTrackController=m["default"],b.hlsDefaultConfig.timelineController=l["default"],b.hlsDefaultConfig.cueHandler=k,b.hlsDefaultConfig.enableCEA708Captions=!0,b.hlsDefaultConfig.enableWebVTT=!0,b.hlsDefaultConfig.captionsTextTrack1Label="English",b.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",b.hlsDefaultConfig.captionsTextTrack2Label="Spanish",b.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",b.hlsDefaultConfig.audioStreamController=j["default"],b.hlsDefaultConfig.audioTrackController=i["default"],b.hlsDefaultConfig.emeController=o["default"]},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(5),h=c(3),i=c(0),j=c(60),k=window.performance,l=function(b){function c(a){var c=b.call(this,a,e["default"].FRAG_LOADING,e["default"].FRAG_LOADED,e["default"].FRAG_BUFFERED,e["default"].ERROR)||this;return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.timer=null,c._bwEstimator=null,c.onCheck=c._abandonRulesCheck.bind(c),c}return d(c,b),c.prototype.destroy=function(){this.clearTimer(),f["default"].prototype.destroy.call(this)},c.prototype.onFragLoading=function(a){var b=a.frag;if("main"===b.type&&(this.timer||(this.fragCurrent=b,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var c=this.hls,d=c.config,e=b.level,f=void 0,g=void 0;c.levels[e].details.live?(f=d.abrEwmaFastLive,g=d.abrEwmaSlowLive):(f=d.abrEwmaFastVoD,g=d.abrEwmaSlowVoD),this._bwEstimator=new j["default"](c,g,f,d.abrEwmaDefaultEstimate)}},c.prototype._abandonRulesCheck=function(){var a=this.hls,b=a.media,c=this.fragCurrent;if(c){var d=c.loader,f=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return i.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var h=d.stats;if(b&&h&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var j=k.now()-h.trequest,l=Math.abs(b.playbackRate);if(j>500*c.duration/l){var m=a.levels,n=Math.max(1,h.bw?h.bw/8:1e3*h.loaded/j),o=m[c.level],p=o.realBitrate?Math.max(o.realBitrate,o.bitrate):o.bitrate,q=h.total?h.total:Math.max(h.loaded,Math.round(c.duration*p/8)),r=b.currentTime,s=(q-h.loaded)/n,t=(g.BufferHelper.bufferInfo(b,r,a.config.maxBufferHole).end-r)/l;if(t<2*c.duration/l&&s>t){var u=void 0,v=void 0;for(v=c.level-1;v>f;v--){var w=m[v].realBitrate?Math.max(m[v].realBitrate,m[v].bitrate):m[v].bitrate;if((u=c.duration*w/(6.4*n))<t)break}s>u&&(i.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+u.toFixed(1)+"<"+s.toFixed(1)+":"+t.toFixed(1)),a.nextLoadLevel=v,this._bwEstimator.sample(j,h.loaded),d.abort(),this.clearTimer(),a.trigger(e["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:h}))}}}}},c.prototype.onFragLoaded=function(b){var c=b.frag;if("main"===c.type&&a.isFinite(c.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[c.level],e=(d.loaded?d.loaded.bytes:0)+b.stats.loaded,f=(d.loaded?d.loaded.duration:0)+b.frag.duration;d.loaded={bytes:e,duration:f},d.realBitrate=Math.round(8*e/f)}if(b.frag.bitrateTest){var g=b.stats;g.tparsed=g.tbuffered=g.tload,this.onFragBuffered(b)}}},c.prototype.onFragBuffered=function(b){var c=b.stats,d=b.frag;if(!0!==c.aborted&&"main"===d.type&&a.isFinite(d.sn)&&(!d.bitrateTest||c.tload===c.tbuffered)){var e=c.tparsed-c.trequest;i.logger.log("latency/loading/parsing/append/kbps:"+Math.round(c.tfirst-c.trequest)+"/"+Math.round(c.tload-c.tfirst)+"/"+Math.round(c.tparsed-c.tload)+"/"+Math.round(c.tbuffered-c.tparsed)+"/"+Math.round(8*c.loaded/(c.tbuffered-c.trequest))),this._bwEstimator.sample(e,c.loaded),c.bwEstimate=this._bwEstimator.getEstimate(),d.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}},c.prototype.onError=function(a){switch(a.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},c.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(c.prototype,"nextAutoLevel",{get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return-1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_nextABRAutoLevel",{get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,h=this.lastLoadedFragLevel,j=this.fragCurrent?this.fragCurrent.duration:0,k=f?f.currentTime:0,l=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,m=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,n=(g.BufferHelper.bufferInfo(f,k,d.maxBufferHole).end-k)/l,o=this._findBestLevel(h,j,m,e,b,n,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(o>=0)return o;i.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=j?Math.min(j,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor;if(0===n){var s=this.bitrateTestDelay;s&&(p=(j?Math.min(j,d.maxLoadingDelay):d.maxLoadingDelay)-s,i.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),q=r=1)}return o=this._findBestLevel(h,j,m,e,b,n+p,q,r,c),Math.max(o,0)},enumerable:!0,configurable:!0}),c.prototype._findBestLevel=function(a,b,c,d,e,f,g,h,j){for(var k=e;k>=d;k--){var l=j[k];if(l){var m=l.details,n=m?m.totalduration/m.fragments.length:b,o=!!m&&m.live,p=void 0;p=a>=k?g*c:h*c;var q=j[k].realBitrate?Math.max(j[k].realBitrate,j[k].bitrate):j[k].bitrate,r=q*n/p;if(i.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(p)+"/"+q+"/"+n+"/"+f+"/"+r),p>q&&(!r||o&&!this.bitrateTestDelay||f>r))return k}}return-1},c}(f["default"]);b["default"]=l}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(61),e=function(){function a(a,b,c,e){this.hls=a,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new d["default"](b),this.fast_=new d["default"](c)}return a.prototype.sample=function(a,b){var c=8e3*b/(a=Math.max(a,this.minDelayMs_)),d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)},a.prototype.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},a.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.prototype.destroy=function(){},a}();b["default"]=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a){this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=0,this.totalWeight_=0}return a.prototype.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},a.prototype.getTotalWeight=function(){return this.totalWeight_},a.prototype.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_},a}();b["default"]=d},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(0),h=c(3),i=c(14).getMediaSource(),j=function(b){function c(a){var c=b.call(this,a,e["default"].MEDIA_ATTACHING,e["default"].MEDIA_DETACHING,e["default"].MANIFEST_PARSED,e["default"].BUFFER_RESET,e["default"].BUFFER_APPENDING,e["default"].BUFFER_CODECS,e["default"].BUFFER_EOS,e["default"].BUFFER_FLUSHING,e["default"].LEVEL_PTS_UPDATED,e["default"].LEVEL_UPDATED)||this;return c._msDuration=null,c._levelDuration=null,c._levelTargetDuration=10,c._live=null,c._objectUrl=null,c.bufferCodecEventsExpected=0,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return d(c,b),c.prototype.destroy=function(){f["default"].prototype.destroy.call(this)},c.prototype.onLevelPtsUpdated=function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio;if(Math.abs(d.timestampOffset-a.start)>.1){var e=d.updating;try{d.abort()}catch(a){g.logger.warn("can not abort audio buffer: "+a)}e?this.audioTimestampOffset=a.start:(g.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}},c.prototype.onManifestParsed=function(a){this.bufferCodecEventsExpected=a.altAudio?2:1,g.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.prototype.onMediaAttaching=function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new i;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=window.URL.createObjectURL(c),this._objectUrl=b.src}},c.prototype.onMediaDetaching=function(){g.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(a){g.logger.warn("onMediaDetaching:"+a.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):g.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(e["default"].MEDIA_DETACHED)},c.prototype.onMediaSourceOpen=function(){g.logger.log("media source opened"),this.hls.trigger(e["default"].MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},c.prototype.checkPendingTracks=function(){var a=this.bufferCodecEventsExpected,b=this.pendingTracks,c=Object.keys(b).length;(c&&!a||2===c)&&(this.createSourceBuffers(b),this.pendingTracks={},this.doAppending())},c.prototype.onMediaSourceClose=function(){g.logger.log("media source closed")},c.prototype.onMediaSourceEnded=function(){g.logger.log("media source ended")},c.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;g.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0),d={},f=this.sourceBuffer;for(var h in f)d[h]=f[h].buffered;this.hls.trigger(e["default"].BUFFER_APPENDED,{parent:b,pending:c,timeRanges:d}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===c&&this.flushLiveBackBuffer()},c.prototype.onSBUpdateError=function(a){g.logger.error("sourceBuffer error:",a),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},c.prototype.onBufferReset=function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},c.prototype.onBufferCodecs=function(a){var b=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(a).forEach(function(c){b.pendingTracks[c]=a[c]});var c=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),c&&"open"===c.readyState&&this.checkPendingTracks()}},c.prototype.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var f=a[d],i=f.levelCodec||f.codec,j=f.container+";codecs="+i;g.logger.log("creating sourceBuffer("+j+")");try{var k=b[d]=c.addSourceBuffer(j);k.addEventListener("updateend",this.onsbue),k.addEventListener("error",this.onsbe),this.tracks[d]={codec:i,container:f.container},f.buffer=k}catch(a){g.logger.error("error while trying to add sourceBuffer:"+a.message),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:a,mimeType:j})}}this.hls.trigger(e["default"].BUFFER_CREATED,{tracks:a})},c.prototype.onBufferAppending=function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())},c.prototype.onBufferAppendFail=function(a){g.logger.error("sourceBuffer error:",a.event),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},c.prototype.onBufferEos=function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,g.logger.log(d+" sourceBuffer now EOS"));this.checkEos()},c.prototype.checkEos=function(){var a=this.sourceBuffer,b=this.mediaSource;if(b&&"open"===b.readyState){for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}g.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(a){g.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},c.prototype.onBufferFlushing=function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()},c.prototype.flushLiveBackBuffer=function(){if(this._live){var a=this.hls.config.liveBackBufferLength;if(isFinite(a)&&!(0>a))for(var b=this.media.currentTime,c=this.sourceBuffer,d=Object.keys(c),e=b-Math.max(a,this._levelTargetDuration),f=d.length-1;f>=0;f--){var g=d[f],h=c[g].buffered;h.length>0&&e>h.start(0)&&this.removeBufferRange(g,c[g],0,e)}}},c.prototype.onLevelUpdated=function(a){var b=a.details;b.fragments.length>0&&(this._levelDuration=b.totalduration+b.fragments[0].start,this._levelTargetDuration=b.averagetargetduration||b.targetduration||10,this._live=b.live,this.updateMediaElementDuration())},c.prototype.updateMediaElementDuration=function(){var b,c=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var d in this.sourceBuffer)if(!0===this.sourceBuffer[d].updating)return;b=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===c.liveDurationInfinity?(g.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>b||!a.isFinite(b))&&(g.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},c.prototype.doFlush=function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(a){g.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(e["default"].BUFFER_FLUSHED)}},c.prototype.doAppending=function(){var a=this.hls,b=this.segments,c=this.sourceBuffer;if(Object.keys(c).length){if(this.media.error)return this.segments=[],void g.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(b&&b.length){var d=b.shift();try{var f=c[d.type];f?f.updating?b.unshift(d):(f.ended=!1,this.parent=d.parent,f.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(c){g.logger.error("error while trying to append buffer:"+c.message),b.unshift(d);var i={type:h.ErrorTypes.MEDIA_ERROR,parent:d.parent};22!==c.code?(this.appendError?this.appendError++:this.appendError=1,i.details=h.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry?(g.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],i.fatal=!0,a.trigger(e["default"].ERROR,i)):(i.fatal=!1,a.trigger(e["default"].ERROR,i))):(this.segments=[],i.details=h.ErrorDetails.BUFFER_FULL_ERROR,i.fatal=!1,a.trigger(e["default"].ERROR,i))}}}},c.prototype.flushBuffer=function(a,b,c){var d,e=this.sourceBuffer;if(Object.keys(e).length){if(g.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var f in e)if(!c||f===c){if((d=e[f]).ended=!1,d.updating)return g.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(f,d,a,b))return this.flushBufferCounter++,!1}}else g.logger.warn("abort flushing too many retries");g.logger.log("buffer flushed")}return!0},c.prototype.removeBufferRange=function(a,b,c,d){try{for(var e=0;e<b.buffered.length;e++){var f=b.buffered.start(e),h=b.buffered.end(e),i=Math.max(f,c),j=Math.min(h,d);if(Math.min(j,h)-i>.5)return g.logger.log("sb remove "+a+" ["+i+","+j+"], of ["+f+","+h+"], pos:"+this.media.currentTime),b.remove(i,j),!0}}catch(a){g.logger.warn("removeBufferRange failed",a)}return!1},c}(f["default"]);b["default"]=j}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=function(b){function c(c){var d=b.call(this,c,e["default"].FPS_DROP_LEVEL_CAPPING,e["default"].MEDIA_ATTACHING,e["default"].MANIFEST_PARSED,e["default"].BUFFER_CODECS,e["default"].MEDIA_DETACHING)||this;return d.autoLevelCapping=a.POSITIVE_INFINITY,d.firstLevel=null,d.levels=[],d.media=null,d.restrictedLevels=[],d.timer=null,d}return d(c,b),c.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},c.prototype.onFpsDropLevelCapping=function(a){c.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)},c.prototype.onMediaAttaching=function(a){this.media=a.media instanceof window.HTMLVideoElement?a.media:null},c.prototype.onManifestParsed=function(a){var b=this.hls;this.restrictedLevels=[],this.levels=a.levels,this.firstLevel=a.firstLevel,b.config.capLevelToPlayerSize&&a.video&&this._startCapping()},c.prototype.onBufferCodecs=function(a){this.hls.config.capLevelToPlayerSize&&a.video&&this._startCapping()},c.prototype.onLevelsUpdated=function(a){this.levels=a.levels},c.prototype.onMediaDetaching=function(){this._stopCapping()},c.prototype.detectPlayerSize=function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},c.prototype.getMaxLevel=function(a){var b=this;if(!this.levels)return-1;var d=this.levels.filter(function(d,e){return c.isLevelAllowed(e,b.restrictedLevels)&&a>=e});return c.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},c.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=a.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},c.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=a.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(c.prototype,"mediaWidth",{get:function(){var a,b=this.media;return b&&(a=b.width||b.clientWidth||b.offsetWidth,a*=c.contentScaleFactor),a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"mediaHeight",{get:function(){var a,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight,a*=c.contentScaleFactor),a},enumerable:!0,configurable:!0}),Object.defineProperty(c,"contentScaleFactor",{get:function(){var a=1;try{a=window.devicePixelRatio}catch(a){}return a},enumerable:!0,configurable:!0}),c.isLevelAllowed=function(a,b){return void 0===b&&(b=[]),-1===b.indexOf(a)},c.getMaxLevelByMediaSize=function(a,b,c){if(!a||a&&!a.length)return-1;for(var d=function(a,b){return!b||a.width!==b.width||a.height!==b.height},e=a.length-1,f=0;f<a.length;f+=1){var g=a[f];if((g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}}return e},c}(c(4)["default"]);b["default"]=f}).call(this,c(2).Number)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(4),g=c(0),h=window.performance,i=function(a){function b(b){return a.call(this,b,e["default"].MEDIA_ATTACHING)||this}return d(b,a),b.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},b.prototype.onMediaAttaching=function(a){var b=this.hls.config;b.capLevelOnFPSDrop&&("function"==typeof(this.video=a.media instanceof window.HTMLVideoElement?a.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod))},b.prototype.checkFPS=function(a,b,c){var d=h.now();if(b){if(this.lastTime){var f=d-this.lastTime,i=c-this.lastDroppedFrames,j=b-this.lastDecodedFrames,k=1e3*i/f,l=this.hls;if(l.trigger(e["default"].FPS_DROP,{currentDropped:i,currentDecoded:j,totalDroppedFrames:c}),k>0&&i>l.config.fpsDroppedMonitoringThreshold*j){var m=l.currentLevel;g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=m)&&(m-=1,l.trigger(e["default"].FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:l.currentLevel}),l.autoLevelCapping=m,l.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.prototype.checkFPSInterval=function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)},b}(f["default"]);b["default"]=i},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(0),e=window.performance,f=window.XMLHttpRequest,g=function(){function a(a){a&&a.xhrSetup&&(this.xhrSetup=a.xhrSetup)}return a.prototype.destroy=function(){this.abort(),this.loader=null},a.prototype.abort=function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.prototype.load=function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:e.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()},a.prototype.loadInternal=function(){var a,b=this.context;a=this.loader=new f;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;try{if(d)try{d(a,b.url)}catch(c){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(c){return void this.callbacks.onError({code:a.status,text:c.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},a.prototype.readystatechange=function(a){var b=a.currentTarget,c=b.readyState,f=this.stats,g=this.context,h=this.config;if(!f.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===f.tfirst&&(f.tfirst=Math.max(e.now(),f.trequest)),4===c){var i=b.status;if(i>=200&&300>i){f.tload=Math.max(f.tfirst,e.now());var j=void 0,k=void 0;k="arraybuffer"===g.responseType?(j=b.response).byteLength:(j=b.responseText).length,f.loaded=f.total=k;var l={url:b.responseURL,data:j};this.callbacks.onSuccess(l,f,g,b)}else f.retry>=h.maxRetry||i>=400&&499>i?(d.logger.error(i+" while loading "+g.url),this.callbacks.onError({code:i,text:b.statusText},g,b)):(d.logger.warn(i+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),f.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),h.timeout)},a.prototype.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.prototype.loadprogress=function(a){var b=a.currentTarget,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null,b)},a}();b["default"]=g},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(28),g=c(0),h=c(3),i=function(a){function b(b){var c=a.call(this,b,e["default"].MANIFEST_LOADING,e["default"].MANIFEST_PARSED,e["default"].AUDIO_TRACK_LOADED,e["default"].AUDIO_TRACK_SWITCHED,e["default"].LEVEL_LOADED,e["default"].ERROR)||this;return c._trackId=-1,c._selectDefaultTrack=!0,c.tracks=[],c.trackIdBlacklist=Object.create(null),
c.audioGroupId=null,c}return d(b,a),b.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},b.prototype.onManifestParsed=function(a){var b=this.tracks=a.audioTracks||[];this.hls.trigger(e["default"].AUDIO_TRACKS_UPDATED,{audioTracks:b})},b.prototype.onAudioTrackLoaded=function(a){if(a.id>=this.tracks.length)g.logger.warn("Invalid audio track id:",a.id);else{if(g.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.hasInterval()){var b=1e3*a.details.targetduration;this.setInterval(b)}!a.details.live&&this.hasInterval()&&this.clearInterval()}},b.prototype.onAudioTrackSwitched=function(a){var b=this.tracks[a.id].groupId;b&&this.audioGroupId!==b&&(this.audioGroupId=b)},b.prototype.onLevelLoaded=function(a){var b=this.hls.levels[a.level];if(b.audioGroupIds){var c=b.audioGroupIds[b.urlId];this.audioGroupId!==c&&(this.audioGroupId=c,this._selectInitialAudioTrack())}},b.prototype.onError=function(a){a.type===h.ErrorTypes.NETWORK_ERROR&&(a.fatal&&this.clearInterval(),a.details===h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(g.logger.warn("Network failure on audio-track id:",a.context.id),this._handleLoadError()))},Object.defineProperty(b.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTrack",{get:function(){return this._trackId},set:function(a){this._setAudioTrack(a),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),b.prototype._setAudioTrack=function(a){if(this._trackId===a&&this.tracks[this._trackId].details)g.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(0>a||a>=this.tracks.length)g.logger.warn("Invalid id passed to audio-track controller");else{var b=this.tracks[a];g.logger.log("Now switching to audio-track index "+a),this.clearInterval(),this._trackId=a;var c=b.url,d=b.type,f=b.id;this.hls.trigger(e["default"].AUDIO_TRACK_SWITCHING,{id:f,type:d,url:c}),this._loadTrackDetailsIfNeeded(b)}},b.prototype.doTick=function(){this._updateTrack(this._trackId)},b.prototype._selectInitialAudioTrack=function(){var a=this,b=this.tracks;if(b.length){var c=this.tracks[this._trackId],d=null;if(c&&(d=c.name),this._selectDefaultTrack){var f=b.filter(function(a){return a["default"]});f.length?b=f:g.logger.warn("No default audio tracks defined")}var i=!1,j=function(){b.forEach(function(b){i||a.audioGroupId&&b.groupId!==a.audioGroupId||d&&d!==b.name||(a._setAudioTrack(b.id),i=!0)})};j(),i||(d=null,j()),i||(g.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(e["default"].ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},b.prototype._needsTrackLoading=function(a){var b=a.details,c=a.url;return!(b&&!b.live||!c)},b.prototype._loadTrackDetailsIfNeeded=function(a){if(this._needsTrackLoading(a)){var b=a.url,c=a.id;g.logger.log("loading audio-track playlist for id: "+c),this.hls.trigger(e["default"].AUDIO_TRACK_LOADING,{url:b,id:c})}},b.prototype._updateTrack=function(a){if(!(0>a||a>=this.tracks.length)){this.clearInterval(),this._trackId=a,g.logger.log("trying to update audio-track "+a);var b=this.tracks[a];this._loadTrackDetailsIfNeeded(b)}},b.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var a=this._trackId,b=this.tracks[a],c=b.name,d=b.language,e=b.groupId;g.logger.warn("Loading failed on audio track id: "+a+", group-id: "+e+', name/language: "'+c+'" / "'+d+'"');for(var f=a,h=0;h<this.tracks.length;h++)if(!this.trackIdBlacklist[h]&&this.tracks[h].name===c){f=h;break}f!==a?(g.logger.log("Attempting audio-track fallback id:",f,"group-id:",this.tracks[f].groupId),this._setAudioTrack(f)):g.logger.warn('No fallback audio-track found for name/language: "'+c+'" / "'+d+'"')},b}(f["default"]);b["default"]=i},function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(10),f=c(5),g=c(20),h=c(1),i=c(8),j=c(25),k=c(3),l=c(0),m=c(26),n=c(7),o=c(12),p=c(15),q=window.performance,r=function(b){function c(a,c){var d=b.call(this,a,h["default"].MEDIA_ATTACHED,h["default"].MEDIA_DETACHING,h["default"].AUDIO_TRACKS_UPDATED,h["default"].AUDIO_TRACK_SWITCHING,h["default"].AUDIO_TRACK_LOADED,h["default"].KEY_LOADED,h["default"].FRAG_LOADED,h["default"].FRAG_PARSING_INIT_SEGMENT,h["default"].FRAG_PARSING_DATA,h["default"].FRAG_PARSED,h["default"].ERROR,h["default"].BUFFER_RESET,h["default"].BUFFER_CREATED,h["default"].BUFFER_APPENDED,h["default"].BUFFER_FLUSHED,h["default"].INIT_PTS_FOUND)||this;return d.fragmentTracker=c,d.config=a.config,d.audioCodecSwap=!1,d._state=p.State.STOPPED,d.initPTS=[],d.waitingFragment=null,d.videoTrackCC=null,d}return d(c,b),c.prototype.onInitPtsFound=function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,this.videoTrackCC=c,l.logger.log("InitPTS for cc: "+c+" found from video track: "+d),this.state===p.State.WAITING_INIT_PTS&&this.tick())},c.prototype.startLoad=function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,b>0&&-1===a?(l.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=p.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=p.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=p.State.STOPPED},Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(a){if(this.state!==a){var b=this.state;this._state=a,l.logger.log("audio stream:"+b+"->"+a)}},enumerable:!0,configurable:!0}),c.prototype.doTick=function(){var b,c,d,g=this.hls,i=g.config;switch(this.state){case p.State.ERROR:case p.State.PAUSED:case p.State.BUFFER_FLUSHING:break;case p.State.STARTING:this.state=p.State.WAITING_TRACK,this.loadedmetadata=!1;break;case p.State.IDLE:var j=this.tracks;if(!j)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)b=this.media.currentTime;else if(void 0===(b=this.nextLoadPosition))break;var k=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,r=f.BufferHelper.bufferInfo(k,b,i.maxBufferHole),s=f.BufferHelper.bufferInfo(o,b,i.maxBufferHole),t=r.len,u=r.end,v=this.fragPrevious,w=Math.min(i.maxBufferLength,i.maxMaxBufferLength),x=Math.max(w,s.len),y=this.audioSwitch,z=this.trackId;if((x>t||y)&&z<j.length){if(void 0===(d=j[z].details)){this.state=p.State.WAITING_TRACK;break}if(!y&&this._streamEnded(r,d))return this.hls.trigger(h["default"].BUFFER_EOS,{type:"audio"}),void(this.state=p.State.ENDED);var A=d.fragments,B=A.length,C=A[0].start,D=A[B-1].start+A[B-1].duration,E=void 0;if(y)if(d.live&&!d.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),u=0;else if(u=b,d.PTSKnown&&C>b){if(!(r.end>C||r.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=C+.05}if(d.initSegment&&!d.initSegment.data)E=d.initSegment;else if(C>=u){if(E=A[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=m.findFragWithCC(A,this.videoTrackCC)),d.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var F=r.nextStart?r.nextStart:C;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(F+.05)),void(this.media.currentTime=F+.05)}}else{var G=void 0,H=i.maxFragLookUpTolerance,I=v?A[v.sn-A[0].sn+1]:void 0,J=function(a){var b=Math.min(H,a.duration);return a.start+a.duration-b<=u?1:a.start-b>u&&a.start?-1:0};D>u?(u>D-H&&(H=0),G=I&&!J(I)?I:e["default"].search(A,J)):G=A[B-1],G&&(E=G,C=G.start,v&&E.level===v.level&&E.sn===v.sn&&(E.sn<d.endSN?(E=A[E.sn+1-d.startSN],l.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(l.logger.log("Loading key for "+E.sn+" of ["+d.startSN+" ,"+d.endSN+"],track "+z),this.state=p.State.KEY_LOADING,g.trigger(h["default"].KEY_LOADING,{frag:E})):(l.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+d.startSN+" ,"+d.endSN+"],track "+z+", currentTime:"+b+",bufferEnd:"+u.toFixed(3)),this.fragCurrent=E,(y||this.fragmentTracker.getState(E)===n.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,a.isFinite(E.sn)&&(this.nextLoadPosition=E.start+E.duration),g.trigger(h["default"].FRAG_LOADING,{frag:E}),this.state=p.State.FRAG_LOADING)))}break;case p.State.WAITING_TRACK:(c=this.tracks[this.trackId])&&c.details&&(this.state=p.State.IDLE);break;case p.State.FRAG_LOADING_WAITING_RETRY:var K=q.now(),L=this.retryDate,M=(k=this.media)&&k.seeking;(!L||K>=L||M)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=p.State.IDLE);break;case p.State.WAITING_INIT_PTS:var N=this.videoTrackCC;if(void 0===this.initPTS[N])break;var O=this.waitingFragment;if(O){var P=O.frag.cc;N!==P?(c=this.tracks[this.trackId]).details&&c.details.live&&(l.logger.warn("Waiting fragment CC ("+P+") does not match video track CC ("+N+")"),this.waitingFragment=null,this.state=p.State.IDLE):(this.state=p.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=p.State.IDLE;break;case p.State.STOPPED:case p.State.FRAG_LOADING:case p.State.PARSING:case p.State.PARSED:case p.State.ENDED:}},c.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)},c.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},c.prototype.onAudioTracksUpdated=function(a){l.logger.log("audio tracks updated"),this.tracks=a.audioTracks},c.prototype.onAudioTrackSwitching=function(a){var b=!!a.url;this.trackId=a.id,this.fragCurrent=null,this.state=p.State.PAUSED,this.waitingFragment=null,b?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=p.State.IDLE),this.tick()},c.prototype.onAudioTrackLoaded=function(b){var c=b.details,d=b.id,e=this.tracks[d],f=c.totalduration,g=0;if(l.logger.log("track "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+f),c.live){var h=e.details;h&&c.fragments.length>0?(i.mergeDetails(h,c),g=c.fragments[0].start,c.PTSKnown?l.logger.log("live audio playlist sliding:"+g.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(c.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding"))}else c.PTSKnown=!1;if(e.details=c,!this.startFragRequested){if(-1===this.startPosition){var j=c.startTimeOffset;a.isFinite(j)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+j),this.startPosition=j):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===p.State.WAITING_TRACK&&(this.state=p.State.IDLE),this.tick()},c.prototype.onKeyLoaded=function(){this.state===p.State.KEY_LOADING&&(this.state=p.State.IDLE,this.tick())},c.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===p.State.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,i=b.level,j=b.sn,k=b.cc,m=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",n=this.stats=a.stats;if("initSegment"===j)this.state=p.State.IDLE,n.tparsed=n.tbuffered=q.now(),e.initSegment.data=a.payload,this.hls.trigger(h["default"].FRAG_BUFFERED,{stats:n,frag:b,id:"audio"}),this.tick();else{this.state=p.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new g["default"](this.hls,"audio"));var o=this.initPTS[k],r=e.initSegment?e.initSegment.data:[];e.initSegment||void 0!==o?(this.pendingBuffering=!0,l.logger.log("Demuxing "+j+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.demuxer.push(a.payload,r,m,null,b,f,!1,o)):(l.logger.log("unknown video PTS for continuity counter "+k+", waiting for video PTS before demuxing audio frag "+j+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.waitingFragment=a,this.state=p.State.WAITING_INIT_PTS)}}this.fragLoadError=0},c.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===p.State.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec=e.codec,e.id=a.id,this.hls.trigger(h["default"].BUFFER_CODECS,d),l.logger.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h["default"].BUFFER_APPENDING,g))}this.tick()}}},c.prototype.onFragParsingData=function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"audio"===b.id&&"audio"===b.type&&e.sn===d.sn&&e.level===d.level&&this.state===p.State.PARSING){var f=this.trackId,g=this.tracks[f],j=this.hls;a.isFinite(b.endPTS)||(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),d.addElementaryStream(o["default"].ElementaryStreamTypes.AUDIO),l.logger.log("parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb),i.updateFragPTSDTS(g.details,d,b.startPTS,b.endPTS);var m=this.audioSwitch,n=this.media,q=!1;if(m&&n)if(n.readyState){var r=n.currentTime;l.logger.log("switching audio track : currentTime:"+r),r>=b.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=p.State.BUFFER_FLUSHING,j.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}),q=!0,this.audioSwitch=!1,j.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:f}))}else this.audioSwitch=!1,j.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:f});var s=this.pendingData;if(!s)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void j.trigger(h["default"].ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([b.data1,b.data2].forEach(function(a){a&&a.length&&s.push({type:b.type,data:a,parent:"audio",content:"data"})}),!q&&s.length&&(s.forEach(function(a){c.state===p.State.PARSING&&(c.pendingBuffering=!0,c.hls.trigger(h["default"].BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}},c.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===p.State.PARSING&&(this.stats.tparsed=q.now(),this.state=p.State.PARSED,this._checkAppendedParsed())},c.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},c.prototype.onBufferCreated=function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},c.prototype.onBufferAppended=function(a){if("audio"===a.parent){var b=this.state;b!==p.State.PARSING&&b!==p.State.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},c.prototype._checkAppendedParsed=function(){if(!(this.state!==p.State.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=q.now(),c.trigger(h["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;l.logger.log("audio buffered : "+j["default"].toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(h["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=p.State.IDLE}this.tick()}},c.prototype.onError=function(b){var c=b.frag;if(!c||"audio"===c.type)switch(b.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:var d=b.frag;if(d&&"audio"!==d.type)break;if(!b.fatal){var e=this.fragLoadError;if(e?e++:e=1,e<=(i=this.config).fragLoadingMaxRetry){this.fragLoadError=e;var g=Math.min(Math.pow(2,e-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);l.logger.warn("AudioStreamController: frag loading failed, retry in "+g+" ms"),this.retryDate=q.now()+g,this.state=p.State.FRAG_LOADING_WAITING_RETRY}else l.logger.error("AudioStreamController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=p.State.ERROR}break;case k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==p.State.ERROR&&(this.state=b.fatal?p.State.ERROR:p.State.IDLE,l.logger.warn("AudioStreamController: "+b.details+" while loading frag, now switching to "+this.state+" state ..."));break;case k.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===b.parent&&(this.state===p.State.PARSING||this.state===p.State.PARSED)){var i,j=this.mediaBuffer,m=this.media.currentTime;j&&f.BufferHelper.isBuffered(j,m)&&f.BufferHelper.isBuffered(j,m+.5)?((i=this.config).maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+i.maxMaxBufferLength+"s")),this.state=p.State.IDLE):(l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=p.State.BUFFER_FLUSHING,this.hls.trigger(h["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}))}}},c.prototype.onBufferFlushed=function(){var a=this,b=this.pendingData;b&&b.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),b.forEach(function(b){a.hls.trigger(h["default"].BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=p.State.PARSED):(this.state=p.State.IDLE,this.fragPrevious=null,this.tick())},c}(p["default"]);b["default"]=r}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(30);b.newCue=function(a,b,c,e){for(var f,g,h,i,j,k=window.VTTCue||window.TextTrackCue,l=0;l<e.rows.length;l++)if(h=!0,i=0,j="",!(f=e.rows[l]).isEmpty()){for(var m=0;m<f.chars.length;m++)f.chars[m].uchar.match(/\s/)&&h?i++:(j+=f.chars[m].uchar,h=!1);f.cueStartTime=b,b===c&&(c+=1e-4),g=new k(b,c,d.fixLineBreaks(j.trim())),i>=16?i--:i++,navigator.userAgent.match(/Firefox\//)?g.line=l+1:g.line=l>7?l-2:l+1,g.align="left",g.position=Math.max(0,Math.min(100,i/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(g)}}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b["default"]=function(){function a(a){return"string"==typeof a&&!!f[a.toLowerCase()]&&a.toLowerCase()}function b(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function c(c,f,g){var h=this,i=function(){return"undefined"!=typeof navigator?/MSIE\s8\.0/.test(navigator.userAgent):void 0}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=c,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";return Object.defineProperty(h,"id",b({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",b({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",b({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",b({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",b({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",b({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",b({},j,{get:function(){return q},set:function(a){var b=function(a){return"string"==typeof a&&!!e[a.toLowerCase()]&&a.toLowerCase()}(a);if(!1===b)throw new SyntaxError("An invalid or illegal string was specified.");q=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",b({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",b({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==d)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",b({},j,{get:function(){return t},set:function(b){var c=a(b);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",b({},j,{get:function(){return u},set:function(a){if(0>a||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",b({},j,{get:function(){return v},set:function(b){var c=a(b);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",b({},j,{get:function(){return w},set:function(a){if(0>a||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",b({},j,{get:function(){return x},set:function(b){var c=a(b);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i?h:void 0}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var d="auto",e={"":!0,lr:!0,rl:!0},f={start:!0,middle:!0,end:!0,left:!0,right:!0};return c.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},c}()},function(a,b,c){"use strict";(function(a){function d(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function e(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(1),h=c(4),i=c(71),j=c(72),k=c(73),l=c(0),m=c(29),n=function(b){function c(a){var c=b.call(this,a,g["default"].MEDIA_ATTACHING,g["default"].MEDIA_DETACHING,g["default"].FRAG_PARSING_USERDATA,g["default"].FRAG_DECRYPTED,g["default"].MANIFEST_LOADING,g["default"].MANIFEST_LOADED,g["default"].FRAG_LOADED,g["default"].LEVEL_SWITCHING,g["default"].INIT_PTS_FOUND)||this;if(c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.textTracks=[],c.tracks=[],c.unparsedVttFrags=[],c.initPTS=[],c.cueRanges=[],c.captionsTracks={},c.captionsProperties={textTrack1:{label:c.config.captionsTextTrack1Label,languageCode:c.config.captionsTextTrack1LanguageCode},textTrack2:{label:c.config.captionsTextTrack2Label,languageCode:c.config.captionsTextTrack2LanguageCode}},c.config.enableCEA708Captions){var d=new j["default"](c,"textTrack1"),e=new j["default"](c,"textTrack2");c.cea608Parser=new i["default"](0,d,e)}return c}return f(c,b),c.prototype.addCues=function(a,b,c,d){for(var f=this.cueRanges,g=!1,h=f.length;h--;){var i=f[h],j=e(i[0],i[1],b,c);if(j>=0&&(i[0]=Math.min(i[0],b),i[1]=Math.max(i[1],c),g=!0,j/(c-b)>.5))return}g||f.push([b,c]),this.Cues.newCue(this.captionsTracks[a],b,c,d)},c.prototype.onInitPtsFound=function(a){var b=this;if("main"===a.id&&(this.initPTS[a.frag.cc]=a.initPTS),this.unparsedVttFrags.length){var c=this.unparsedVttFrags;this.unparsedVttFrags=[],c.forEach(function(a){b.onFragLoaded(a)})}},c.prototype.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c];if(d[a])return d}return null},c.prototype.createCaptionsTrack=function(a){var b=this.captionsProperties[a],c=b.label,d=b.languageCode,e=this.captionsTracks;if(!e[a]){var f=this.getExistingTrack(a);if(f)e[a]=f,m.clearCurrentCues(e[a]),m.sendAddTrackEvent(e[a],this.media);else{var g=this.createTextTrack("captions",c,d);g&&(g[a]=!0,e[a]=g)}}},c.prototype.createTextTrack=function(a,b,c){var d=this.media;return d?d.addTextTrack(a,b,c):void 0},c.prototype.destroy=function(){h["default"].prototype.destroy.call(this)},c.prototype.onMediaAttaching=function(a){this.media=a.media,this._cleanTracks()},c.prototype.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){m.clearCurrentCues(a[b]),delete a[b]})},c.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,"new":!1}},this._cleanTracks()},c.prototype._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)m.clearCurrentCues(b[c])}},c.prototype.onManifestLoaded=function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,e){var f;if(e<c.length){for(var g=null,h=0;h<c.length;h++)if(d(c[h],a)){g=c[h];break}g&&(f=g)}f||(f=b.createTextTrack("subtitles",a.name,a.lang)),a["default"]?f.mode=b.hls.subtitleDisplay?"showing":"hidden":f.mode="disabled",b.textTracks.push(f)})}},c.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},c.prototype.onFragLoaded=function(b){var c=b.frag,d=b.payload;if("main"===c.type){var e=c.sn;if(e!==this.lastSn+1){var f=this.cea608Parser;f&&f.reset()}this.lastSn=e}else if("subtitle"===c.type)if(d.byteLength){if(!a.isFinite(this.initPTS[c.cc]))return this.unparsedVttFrags.push(b),void(this.initPTS.length&&this.hls.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c}));var h=c.decryptdata;null!=h&&null!=h.key&&"AES-128"===h.method||this._parseVTTs(c,d)}else this.hls.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c})},c.prototype._parseVTTs=function(a,b){var c=this.vttCCs;c[a.cc]||(c[a.cc]={start:a.start,prevCC:this.prevCC,"new":!0},this.prevCC=a.cc);var d=this.textTracks,e=this.hls;k["default"].parse(b,this.initPTS[a.cc],c,a.cc,function(b){var c=d[a.level];"disabled"!==c.mode?(b.forEach(function(a){if(!c.cues.getCueById(a.id))try{c.addCue(a)}catch(b){var d=new window.TextTrackCue(a.startTime,a.endTime,a.text);d.id=a.id,c.addCue(d)}}),e.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})):e.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})},function(b){l.logger.log("Failed to parse VTT cue: "+b),e.trigger(g["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})})},c.prototype.onFragDecrypted=function(b){var c=b.payload,d=b.frag;if("subtitle"===d.type){if(!a.isFinite(this.initPTS[d.cc]))return void this.unparsedVttFrags.push(b);this._parseVTTs(d,c)}},c.prototype.onFragParsingUserdata=function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}},c.prototype.extractCea608Data=function(a){for(var b,c,d,e=31&a[0],f=2,g=[],h=0;e>h;h++)b=a[f++],c=127&a[f++],d=127&a[f++],0===c&&0===d||0!=(4&b)&&0===(3&b)&&(g.push(c),g.push(d));return g},c}(h["default"]);b["default"]=n}).call(this,c(2).Number)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},e=function(a){var b=a;return d.hasOwnProperty(a)&&(b=d[a]),String.fromCharCode(b)},f=15,g=100,h={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},i={17:2,18:4,21:6,22:8,23:10,19:13,20:15},j={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},k={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){this.verboseFilter[a],this.verboseLevel}},n=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},o=function(){function a(a,b,c,d,e){this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1}return a.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.prototype.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},a.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.prototype.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},a.prototype.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},a.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),p=function(){function a(a,b,c,d,e,f){this.uchar=a||" ",this.penState=new o(b,c,d,e,f)}return a.prototype.reset=function(){this.uchar=" ",this.penState.reset()},a.prototype.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},a.prototype.setPenState=function(a){this.penState.copy(a)},a.prototype.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},a.prototype.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},a.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),q=function(){function a(){this.chars=[];for(var a=0;g>a;a++)this.chars.push(new p);this.pos=0,this.currPenState=new o}return a.prototype.equals=function(a){for(var b=!0,c=0;g>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;g>b;b++)this.chars[b].copy(a.chars[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;g>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},a.prototype.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(m.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>g&&(m.log("ERROR","Too large cursor position "+this.pos),this.pos=g)},a.prototype.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;b+1>c;c++)this.chars[c].setPenState(this.currPenState);
this.setCursor(b)},a.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.prototype.insertChar=function(a){a>=144&&this.backSpace();var b=e(a);this.pos>=g?m.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1))},a.prototype.clearFromPos=function(a){var b;for(b=a;g>b;b++)this.chars[b].reset()},a.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.prototype.getTextString=function(){for(var a=[],b=!0,c=0;g>c;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},a.prototype.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},a}(),r=function(){function a(){this.rows=[];for(var a=0;f>a;a++)this.rows.push(new q);this.currRow=f-1,this.nrRollUpRows=null,this.reset()}return a.prototype.reset=function(){for(var a=0;f>a;a++)this.rows[a].clear();this.currRow=f-1},a.prototype.equals=function(a){for(var b=!0,c=0;f>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;f>b;b++)this.rows[b].copy(a.rows[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;f>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},a.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},a.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},a.prototype.insertChar=function(a){this.rows[this.currRow].insertChar(a)},a.prototype.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},a.prototype.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},a.prototype.setCursor=function(a){m.log("INFO","setCursor: "+a),this.rows[this.currRow].setCursor(a)},a.prototype.setPAC=function(a){m.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;f>c;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var g=e.rows[d].cueStartTime;if(g&&g<m.time)for(c=0;c<this.nrRollUpRows;c++)this.rows[b-this.nrRollUpRows+c+1].copy(e.rows[d+c])}}this.currRow=b;var h=this.rows[this.currRow];if(null!==a.indent){var i=a.indent,j=Math.max(i-1,0);h.setCursor(a.indent),a.color=h.chars[j].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)},a.prototype.setBkgData=function(a){m.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},a.prototype.setRollUpRows=function(a){this.nrRollUpRows=a},a.prototype.rollUp=function(){if(null!==this.nrRollUpRows){m.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),m.log("INFO","Rolling up")}else m.log("DEBUG","roll_up but nrRollUpRows not set yet")},a.prototype.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;f>e;e++){var g=this.rows[e].getTextString();g&&(d=e+1,a?b.push("Row "+d+": '"+g+"'"):b.push(g.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},a.prototype.getTextAndFormat=function(){return this.rows},a}(),s=function(){function a(a,b){this.chNr=a,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new r,this.nonDisplayedMemory=new r,this.lastOutputScreen=new r,this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},a.prototype.getHandler=function(){return this.outputFilter},a.prototype.setHandler=function(a){this.outputFilter=a},a.prototype.setPAC=function(a){this.writeScreen.setPAC(a)},a.prototype.setBkgData=function(a){this.writeScreen.setBkgData(a)},a.prototype.setMode=function(a){a!==this.mode&&(this.mode=a,m.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},a.prototype.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";m.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(m.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.prototype.ccRCL=function(){m.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.prototype.ccBS=function(){m.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.prototype.ccAOF=function(){},a.prototype.ccAON=function(){},a.prototype.ccDER=function(){m.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.prototype.ccRU=function(a){m.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},a.prototype.ccFON=function(){m.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.prototype.ccRDC=function(){m.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.prototype.ccTR=function(){m.log("INFO","TR"),this.setMode("MODE_TEXT")},a.prototype.ccRTD=function(){m.log("INFO","RTD"),this.setMode("MODE_TEXT")},a.prototype.ccEDM=function(){m.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.prototype.ccCR=function(){m.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.prototype.ccENM=function(){m.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.prototype.ccEOC=function(){if(m.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,m.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.prototype.ccTO=function(a){m.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},a.prototype.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2==1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16;b.foreground=["white","green","blue","cyan","red","yellow","magenta"][c]}m.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},a.prototype.outputDataUpdate=function(a){void 0===a&&(a=!1);var b=m.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),!0===a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},a.prototype.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},a}(),t=function(){function a(a,b,c){this.field=a||1,this.outputs=[b,c],this.channels=[new s(1,b),new s(2,c)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return a.prototype.getHandler=function(a){return this.channels[a].getHandler()},a.prototype.setHandler=function(a,b){this.channels[a].setHandler(b)},a.prototype.addData=function(a,b){var c,d,e,f=!1;this.lastTime=a,m.setTime(a);for(var g=0;g<b.length;g+=2)d=127&b[g],e=127&b[g+1],0!==d||0!==e?(m.log("DATA","["+n([b[g],b[g+1]])+"] -> ("+n([d,e])+")"),(c=this.parseCmd(d,e))||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),c||(f=this.parseChars(d,e))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(f):m.log("WARNING","No channel found yet. TEXT-MODE?")),c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,m.log("WARNING","Couldn't parse cleaned data "+n([d,e])+" orig: "+n([b[g],b[g+1]])))):this.dataCounters.padding+=2},a.prototype.parseCmd=function(a,b){var c=null;if(!((20===a||28===a)&&b>=32&&47>=b||(23===a||31===a)&&b>=33&&35>=b))return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,m.log("DEBUG","Repeated command ("+n([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var d=this.channels[c-1];return 20===a||28===a?32===b?d.ccRCL():33===b?d.ccBS():34===b?d.ccAOF():35===b?d.ccAON():36===b?d.ccDER():37===b?d.ccRU(2):38===b?d.ccRU(3):39===b?d.ccRU(4):40===b?d.ccFON():41===b?d.ccRDC():42===b?d.ccTR():43===b?d.ccRTD():44===b?d.ccEDM():45===b?d.ccCR():46===b?d.ccENM():47===b&&d.ccEOC():d.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.parseMidrow=function(a,b){var c=null;return(17===a||25===a)&&b>=32&&47>=b&&((c=17===a?1:2)!==this.currChNr?(m.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[c-1].ccMIDROW(b),m.log("DEBUG","MIDROW ("+n([a,b])+")"),!0))},a.prototype.parsePAC=function(a,b){var c,d=null;if(!((a>=17&&23>=a||a>=25&&31>=a)&&b>=64&&127>=b||(16===a||24===a)&&b>=64&&95>=b))return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=23>=a?1:2,d=b>=64&&95>=b?1===c?h[a]:j[a]:1===c?i[a]:k[a];var e=this.interpretPAC(d,b);return this.channels[c-1].setPAC(e),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.interpretPAC=function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1==(1&c),13>=c?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:15>=c?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},a.prototype.parseChars=function(a,b){var c=null,d=null,f=null;if(a>=25?(c=2,f=a-8):(c=1,f=a),f>=17&&19>=f){var g=b;g=17===f?b+80:18===f?b+112:b+144,m.log("INFO","Special char '"+e(g)+"' in channel "+c),d=[g]}else a>=32&&127>=a&&(d=0===b?[a]:[a,b]);if(d){var h=n(d);m.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d},a.prototype.parseBackgroundAttributes=function(a,b){var c,d,e;return((16===a||24===a)&&b>=32&&47>=b||(23===a||31===a)&&b>=45&&47>=b)&&(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=l[d],b%2==1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=24>a?1:2,this.channels[e-1].setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0)},a.prototype.reset=function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null},a.prototype.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)},a}();b["default"]=t},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.timelineController=a,this.trackName=b,this.startTime=null,this.endTime=null,this.screen=null}return a.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},a.prototype.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},a}();b["default"]=d},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c(30),e=c(11),f=function(a,b,c){return a.substr(c||0,b.length)===b},g=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return(b>>>0).toString()},h={parse:function(a,b,c,h,i,j){var k,l=e.utf8ArrayToStr(new Uint8Array(a)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),m="00:00.000",n=0,o=0,p=0,q=[],r=!0,s=new d["default"];s.oncue=function(a){var b=c[h],d=c.ccOffset;b&&b["new"]&&(void 0!==o?d=c.ccOffset=b.start:function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e["new"]&&d["new"])return a.ccOffset=a.presentationOffset=d.start,void(d["new"]=!1);for(;e&&e["new"];)a.ccOffset+=d.start-e.start,d["new"]=!1,e=a[(d=e).prevCC];a.presentationOffset=c}(c,h,p)),p&&(d=p-c.presentationOffset),a.startTime+=d-o,a.endTime+=d-o,a.id=g(a.startTime.toString())+g(a.endTime.toString())+g(a.text),a.text=decodeURIComponent(encodeURIComponent(a.text)),a.endTime>0&&q.push(a)},s.onparsingerror=function(a){k=a},s.onflush=function(){k&&j?j(k):i(q)},l.forEach(function(a){if(r){if(f(a,"X-TIMESTAMP-MAP=")){r=!1,a.substr(16).split(",").forEach(function(a){f(a,"LOCAL:")?m=a.substr(6):f(a,"MPEGTS:")&&(n=parseInt(a.substr(7)))});try{b+(9e4*c[h].start||0)<0&&(b+=8589934592),n-=b,o=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),e=parseInt(a.substr(-9,2)),f=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;return d.isFinite(b)&&d.isFinite(c)&&d.isFinite(e)&&d.isFinite(f)?(b+=1e3*c,b+=6e4*e,b+=36e5*f):-1}(m)/1e3,p=n/9e4,-1===o&&(k=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(d){k=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(r=!1)}s.parse(a+"\n")}),s.flush()}};b["default"]=h}).call(this,c(2).Number)},function(a,b,c){"use strict";(function(a){function d(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"subtitles"===d.kind&&d.label&&b.push(a[c])}return b}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(1),g=c(4),h=c(0),i=c(8),j=function(b){function c(a){var c=b.call(this,a,f["default"].MEDIA_ATTACHED,f["default"].MEDIA_DETACHING,f["default"].MANIFEST_LOADED,f["default"].SUBTITLE_TRACK_LOADED)||this;return c.tracks=[],c.trackId=-1,c.media=null,c.stopped=!0,c.subtitleDisplay=!0,c}return e(c,b),c.prototype.destroy=function(){g["default"].prototype.destroy.call(this)},c.prototype.onMediaAttached=function(a){var b=this;this.media=a.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){b.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},c.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},c.prototype.onManifestLoaded=function(a){var b=this,c=a.subtitles||[];this.tracks=c,this.hls.trigger(f["default"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a["default"]&&(b.media?b.subtitleTrack=a.id:b.queuedDefaultTrack=a.id)})},c.prototype.onSubtitleTrackLoaded=function(a){var b=this,c=a.id,d=a.details,e=this.trackId,f=this.tracks,g=f[e];if(c>=f.length||c!==e||!g||this.stopped)this._clearReloadTimer();else if(h.logger.log("subtitle track "+c+" loaded"),d.live){var j=i.computeReloadInterval(g.details,d,a.stats.trequest);h.logger.log("Reloading live subtitle playlist in "+j+"ms"),this.timer=setTimeout(function(){b._loadCurrentTrack()},j)}else this._clearReloadTimer()},c.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},c.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(c.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(a){this.trackId!==a&&(this._toggleTrackModes(a),this._setSubtitleTrackInternal(a))},enumerable:!0,configurable:!0}),c.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},c.prototype._loadCurrentTrack=function(){var a=this.trackId,b=this.tracks,c=this.hls,d=b[a];0>a||!d||d.details&&!d.details.live||(h.logger.log("Loading subtitle track "+a),c.trigger(f["default"].SUBTITLE_TRACK_LOADING,{url:d.url,id:a}))},c.prototype._toggleTrackModes=function(a){var b=this.media,c=this.subtitleDisplay,e=this.trackId;if(b){var f=d(b.textTracks);if(-1===a)[].slice.call(f).forEach(function(a){a.mode="disabled"});else{var g=f[e];g&&(g.mode="disabled")}var h=f[a];h&&(h.mode=c?"showing":"hidden")}},c.prototype._setSubtitleTrackInternal=function(b){var c=this.hls,d=this.tracks;!a.isFinite(b)||-1>b||b>=d.length||(this.trackId=b,h.logger.log("Switching to subtitle track "+b),c.trigger(f["default"].SUBTITLE_TRACK_SWITCH,{id:b}),this._loadCurrentTrack())},c.prototype._onTextTracksChanged=function(){if(this.media){for(var a=-1,b=d(this.media.textTracks),c=0;c<b.length;c++)if("hidden"===b[c].mode)a=c;else if("showing"===b[c].mode){a=c;break}this.subtitleTrack=a}},c}(g["default"]);b["default"]=j}).call(this,c(2).Number)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=c(0),g=c(13),h=c(5),i=c(27),j=c(7),k=c(15),l=c(8),m=window.performance,n=function(a){function b(b,c){var d=a.call(this,b,e["default"].MEDIA_ATTACHED,e["default"].MEDIA_DETACHING,e["default"].ERROR,e["default"].KEY_LOADED,e["default"].FRAG_LOADED,e["default"].SUBTITLE_TRACKS_UPDATED,e["default"].SUBTITLE_TRACK_SWITCH,e["default"].SUBTITLE_TRACK_LOADED,e["default"].SUBTITLE_FRAG_PROCESSED,e["default"].LEVEL_UPDATED)||this;return d.fragmentTracker=c,d.config=b.config,d.state=k.State.STOPPED,d.tracks=[],d.tracksBuffered=[],d.currentTrackId=-1,d.decrypter=new g["default"](b,b.config),d.lastAVStart=0,d._onMediaSeeking=d.onMediaSeeking.bind(d),d}return d(b,a),b.prototype.onSubtitleFragProcessed=function(a){var b=a.frag,c=a.success;if(this.fragPrevious=b,this.state=k.State.IDLE,c){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var e,f=b.start,g=0;g<d.length;g++)if(f>=d[g].start&&f<=d[g].end){e=d[g];break}var h=b.start+b.duration;e?e.end=h:(e={start:f,end:h},d.push(e))}}},b.prototype.onMediaAttached=function(a){var b=a.media;this.media=b,b.addEventListener("seeking",this._onMediaSeeking),this.state=k.State.IDLE},b.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=k.State.STOPPED},b.prototype.onError=function(a){var b=a.frag;b&&"subtitle"===b.type&&(this.state=k.State.IDLE)},b.prototype.onSubtitleTracksUpdated=function(a){var b=this;f.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=a.subtitleTracks,this.tracks.forEach(function(a){b.tracksBuffered[a.id]=[]})},b.prototype.onSubtitleTrackSwitch=function(a){if(this.currentTrackId=a.id,this.tracks&&-1!==this.currentTrackId){var b=this.tracks[this.currentTrackId];b&&b.details&&this.setInterval(500)}else this.clearInterval()},b.prototype.onSubtitleTrackLoaded=function(a){var b=a.id,c=a.details,d=this.currentTrackId,e=this.tracks,f=e[d];b>=e.length||b!==d||!f||(c.live&&l.mergeSubtitlePlaylists(f.details,c,this.lastAVStart),f.details=c,this.setInterval(500))},b.prototype.onKeyLoaded=function(){this.state===k.State.KEY_LOADING&&(this.state=k.State.IDLE)},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag.decryptdata,d=a.frag,f=this.hls;if(this.state===k.State.FRAG_LOADING&&b&&"subtitle"===a.frag.type&&b.sn===a.frag.sn&&a.payload.byteLength>0&&c&&c.key&&"AES-128"===c.method){var g=m.now();this.decrypter.decrypt(a.payload,c.key.buffer,c.iv.buffer,function(a){var b=m.now();f.trigger(e["default"].FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:g,tdecrypt:b}})})}},b.prototype.onLevelUpdated=function(a){var b=a.details.fragments;this.lastAVStart=b.length?b[0].start:0},b.prototype.doTick=function(){if(this.media)switch(this.state){case k.State.IDLE:var a=this,b=a.config,c=a.currentTrackId,d=a.fragmentTracker,g=a.media,l=a.tracks;if(!l||!l[c]||!l[c].details)break;var m=b.maxBufferHole,n=b.maxFragLookUpTolerance,o=Math.min(b.maxBufferLength,b.maxMaxBufferLength),p=h.BufferHelper.bufferedInfo(this._getBuffered(),g.currentTime,m),q=p.end,r=p.len,s=l[c].details,t=s.fragments,u=t.length,v=t[u-1].start+t[u-1].duration;if(r>o)return;var w=void 0,x=this.fragPrevious;v>q?(x&&s.hasProgramDateTime&&(w=i.findFragmentByPDT(t,x.endProgramDateTime,n)),w||(w=i.findFragmentByPTS(x,t,q,n))):w=t[u-1],w&&w.encrypted?(f.logger.log("Loading key for "+w.sn),this.state=k.State.KEY_LOADING,this.hls.trigger(e["default"].KEY_LOADING,{frag:w})):w&&d.getState(w)===j.FragmentState.NOT_LOADED&&(this.fragCurrent=w,this.state=k.State.FRAG_LOADING,this.hls.trigger(e["default"].FRAG_LOADING,{frag:w}))}else this.state=k.State.IDLE},b.prototype.stopLoad=function(){this.lastAVStart=0,a.prototype.stopLoad.call(this)},b.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},b.prototype.onMediaSeeking=function(){this.fragPrevious=null},b}(k["default"]);b.SubtitleStreamController=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(1),g=c(3),h=c(0),i=window.XMLHttpRequest,j="com.widevine.alpha",k="com.microsoft.playready",l=function(a){function b(b){var c=a.call(this,b,f["default"].MEDIA_ATTACHED,f["default"].MANIFEST_PARSED)||this;return c._widevineLicenseUrl=b.config.widevineLicenseUrl,c._licenseXhrSetup=b.config.licenseXhrSetup,c._emeEnabled=b.config.emeEnabled,c._requestMediaKeySystemAccess=b.config.requestMediaKeySystemAccessFunc,c._mediaKeysList=[],c._media=null,c._hasSetMediaKeys=!1,c._isMediaEncrypted=!1,c._requestLicenseFailureCount=0,c}return d(b,a),b.prototype.getLicenseServerUrl=function(a){var b;switch(a){case j:b=this._widevineLicenseUrl;break;default:b=null}return b||(h.logger.error('No license server URL configured for key-system "'+a+'"'),this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),b},b.prototype._attemptKeySystemAccess=function(a,b,c){var d=this,e=function(a,b,c){switch(a){case j:return function(a,b,c){var d={videoCapabilities:[]};return b.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"'})}),[d]}(0,c);default:throw Error("Unknown key-system: "+a)}}(a,0,c);e?(h.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(a,e).then(function(b){d._onMediaKeySystemAccessObtained(a,b)})["catch"](function(b){h.logger.error('Failed to obtain key-system "'+a+'" access:',b)})):h.logger.warn("Can not create config for key-system (maybe because platform is not supported):",a)},Object.defineProperty(b.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),b.prototype._onMediaKeySystemAccessObtained=function(a,b){var c=this;h.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:b,mediaKeySystemDomain:a};this._mediaKeysList.push(d),b.createMediaKeys().then(function(b){d.mediaKeys=b,h.logger.log('Media-keys created for key-system "'+a+'"'),c._onMediaKeysCreated()})["catch"](function(a){h.logger.error("Failed to create media-keys:",a)})},b.prototype._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),a._onNewMediaKeySession(b.mediaKeysSession))})},b.prototype._onNewMediaKeySession=function(a){var b=this;h.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)},b.prototype._onKeySessionMessage=function(a,b){h.logger.log("Got EME message event, creating license request"),this._requestLicense(b,function(b){h.logger.log("Received license data, updating key-session"),a.update(b)})},b.prototype._onMediaEncrypted=function(a,b){h.logger.log('Media is encrypted using "'+a+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=a,this._mediaEncryptionInitData=b,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},b.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var a=this._mediaKeysList[0];if(!a||!a.mediaKeys)return h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});h.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(a.mediaKeys),this._hasSetMediaKeys=!0}},b.prototype._generateRequestWithPreferredKeySession=function(){var a=this,b=this._mediaKeysList[0];if(!b)return h.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(b.mediaKeysSessionInitialized)h.logger.warn("Key-Session already initialized but requested again");else{var c=b.mediaKeysSession;c||(h.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var d=this._mediaEncryptionInitDataType,e=this._mediaEncryptionInitData;h.logger.log('Generating key-session request for "'+d+'" init data type'),b.mediaKeysSessionInitialized=!0,c.generateRequest(d,e).then(function(){h.logger.debug("Key-session generation succeeded")})["catch"](function(b){h.logger.error("Error generating key-session request:",b),a.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},b.prototype._createLicenseXhr=function(a,b,c){var d=new i,e=this._licenseXhrSetup;try{if(e)try{e(d,a)}catch(b){d.open("POST",a,!0),e(d,a)}d.readyState||d.open("POST",a,!0)}catch(a){return h.logger.error("Error setting up key-system license XHR",a),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return d.responseType="arraybuffer",d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,a,b,c),d},b.prototype._onLicenseRequestReadyStageChange=function(a,b,c,d){switch(a.readyState){case 4:if(200===a.status)this._requestLicenseFailureCount=0,h.logger.log("License request succeeded"),d(a.response);else{if(h.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var e=3-this._requestLicenseFailureCount+1;return h.logger.warn("Retrying license request, "+e+" attempts left"),void this._requestLicense(c,d)}this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},b.prototype._generateLicenseRequestChallenge=function(a,b){var c;return a.mediaKeySystemDomain===k?h.logger.error("PlayReady is not supported (yet)"):a.mediaKeySystemDomain===j?c=b:h.logger.error("Unsupported key-system:",a.mediaKeySystemDomain),c},b.prototype._requestLicense=function(a,b){h.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c)return h.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f["default"].ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var d=this.getLicenseServerUrl(c.mediaKeySystemDomain),e=this._createLicenseXhr(d,a,b);h.logger.log("Sending license request to URL: "+d),e.send(this._generateLicenseRequestChallenge(c,a))},b.prototype.onMediaAttached=function(a){var b=this;if(this._emeEnabled){var c=a.media;this._media=c,c.addEventListener("encrypted",function(a){b._onMediaEncrypted(a.initDataType,a.initData)})}},b.prototype.onManifestParsed=function(a){if(this._emeEnabled){var b=a.levels.map(function(a){return a.audioCodec}),c=a.levels.map(function(a){return a.videoCodec});this._attemptKeySystemAccess(j,b,c)}},b}(e["default"]);b["default"]=l},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;b.requestMediaKeySystemAccess=d}])["default"]}),needsJQuery.ready(function(a){function b(a,b,c,d,e){a.detachMedia(b),a.loadSource(c),a.attachMedia(b),a.once(Hls.Events.MEDIA_ATTACHED,function(){a.once(Hls.Events.FRAG_BUFFERED,function(){setTimeout(function(){e>0&&(b.currentTime=parseInt(e)),d&&b.play()},500)})})}function c(b){managePrestoVideosPlayback(a(b).parent())}function d(b){a(b).attr("data-hls-initialized",!0)}function e(a){a.prev(".play-overlay").show()}const f="application/vnd.apple.mpegurl",g="auto";var h=a(".presto-video");h.each(function(){var h=this,i=a(this),j=i.attr("data-plays-hosted-video");if(j){var k=i.attr("data-hosted-video-source"),l=-1!==navigator.userAgent.indexOf("Chrome")&&-1!==navigator.userAgent.indexOf("Android"),m=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android"),n=h.canPlayType(f)&&!l&&!m,o=Hls.isSupported();if(n)h.src=k,h.addEventListener("loadedmetadata",function(){if(d(h),c(h),e(i),i.attr("preload")!==g){var b=i.parent().find(".presto-scrubber");a(b).one("change",function(a){i.one("loadeddata",function(){var b=a.detail.value;b>0&&(h.currentTime=parseInt(b))})})}});else if(o){const p=new Hls;if(p.loadSource(k),p.attachMedia(h),i.attr("preload")!==g){p.once(Hls.Events.FRAG_PARSED,function(){p.stopLoad(),e(i)});var q=i.parent().find(".presto-scrubber");a(q).one("change",function(a){if(!h.preloaded){var c=a.detail.value,d=!1;b(p,h,k,d,c),h.preloaded=!0}}),i.one("play",function(){if(!h.preloaded){var a=!0,c=0;b(p,h,k,a,c),h.preloaded=!0}})}p.on(Hls.Events.MANIFEST_PARSED,function(){d(h),c(h)})}}})});